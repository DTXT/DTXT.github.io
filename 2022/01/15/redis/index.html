<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="Redis, DTXG的世界">
    <meta name="description" content="redis笔记">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="referrer" content="no-referrer-when-downgrade">
    <!-- Global site tag (gtag.js) - Google Analytics -->


    <title>Redis | DTXG的世界</title>
    <link rel="icon" type="image/png" href="/favicon.png">

    <link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/css/my.css">

    <script src="/libs/jquery/jquery-3.6.0.min.js"></script>

<meta name="generator" content="Hexo 6.0.0"><link rel="alternate" href="/atom.xml" title="DTXG的世界" type="application/atom+xml">

<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
<link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css"></head>



   <style>
    body{
       background-image: url(https://cdn.jsdelivr.net/gh/Tokisaki-Galaxy/res/site/medias/background.jpg);
       background-repeat:no-repeat;
       background-size: 100% 100%;
       background-attachment:fixed;
    }
</style>



<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">DTXG的世界</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>首页</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>标签</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>分类</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>归档</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>关于</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/contact" class="waves-effect waves-light">
      
      <i class="fas fa-comments" style="zoom: 0.6;"></i>
      
      <span>留言板</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/friends" class="waves-effect waves-light">
      
      <i class="fas fa-address-book" style="zoom: 0.6;"></i>
      
      <span>友情链接</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="搜索" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">DTXG的世界</div>
        <div class="logo-desc">
            
            Never really desperate, only the lost of the soul.
            
        </div>
    </div>

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			首页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			标签
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			分类
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			归档
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			关于
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/contact" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-comments"></i>
			
			留言板
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/friends" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-address-book"></i>
			
			友情链接
		</a>
          
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/blinkfox/hexo-theme-matery" class="waves-effect waves-light" target="_blank">
                <i class="fab fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>


        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/blinkfox/hexo-theme-matery" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    



<div class="bg-cover pd-header post-cover" style="background-image: url('https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fpic1.zhimg.com%2Fv2-68ba5c63fb878f074c4ac91e944b24a4_1440w.jpg%3Fsource%3D172ae18b&refer=http%3A%2F%2Fpic1.zhimg.com&app=2002&size=f9999,10000&q=a80&n=0&g=0n&fmt=jpeg?sec=1647483108&t=e5fd4048400832f88cdbf59e49a489b0')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">Redis</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
		height: 70%;
		overflow: auto;
    }


    .toc-widget {
        width: 345px;
        padding-left: 20px;
    }

    .toc-widget .toc-title {
        padding: 35px 0 15px 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content {
        padding-bottom: 30px;
        overflow: auto;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;

        position: absolute;
        right: 23.5vw;
        display: block;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #floating-toc-btn {
        position: fixed;
        right: 15px;
        bottom: 76px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        width: 48px;
        height: 48px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 48px;
        font-size: 1.4rem;
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/Redis/">
                                <span class="chip bg-color">Redis</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fas fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/Redis/" class="post-category">
                                Redis
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2022-01-15
                </div>
                

                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-check fa-fw"></i>更新日期:&nbsp;&nbsp;
                    2022-03-10
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-file-word fa-fw"></i>文章字数:&nbsp;&nbsp;
                    20.6k
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-clock fa-fw"></i>阅读时长:&nbsp;&nbsp;
                    86 分
                </div>
                

                
                    <div id="busuanzi_container_page_pv" class="info-break-policy">
                        <i class="far fa-eye fa-fw"></i>阅读次数:&nbsp;&nbsp;
                        <span id="busuanzi_value_page_pv"></span>
                    </div>
				
            </div>
        </div>
        <hr class="clearfix">

        

        

        <div class="card-content article-card-content">
            <div id="articleContent">
                <h1><span id="nosql概述">Nosql概述</span></h1><h2><span id="单机mysql时代">单机Mysql时代</span></h2><p>90年代,一个网站的访问量一般不会太大，单个数据库完全够用。</p>
<p><img src="/2022/01/15/redis/image-20211201141023679.png" alt="image-20211201141023679"></p>
<p>随着用户增多，网站出现以下问题：</p>
<ol>
<li>数据量增加到一定程度，单机数据库就放不下了</li>
<li>数据的索引（B+ Tree）,一个机器内存也存放不下</li>
<li>访问量变大后（读写混合），一台服务器承受不住。</li>
</ol>
<h2><span id="memcached缓存-mysql-垂直拆分读写分离">Memcached(缓存) + Mysql + 垂直拆分（读写分离）</span></h2><p>网站80%的情况都是在读，每次都要去查询数据库的话就十分的麻烦！所以说我们希望减轻数据库的压力，我们可以<strong>使用缓存</strong>来保证效率！</p>
<p><img src="/2022/01/15/redis/image-20211201141832117.png" alt="image-20211201141832117"></p>
<p>优化过程经历了以下几个过程：</p>
<ol>
<li>优化数据库的数据结构和索引(难度大)</li>
<li>文件缓存，通过IO流获取比每次都访问数据库效率略高，但是流量爆炸式增长时候，IO流也承受不了</li>
<li>MemCache,当时最热门的技术，通过在数据库和数据库访问层之间加上一层缓存，第一次访问时查询数据库，将结果保存到缓存，后续的查询先检查缓存，若有直接拿去使用，效率显著提升。</li>
</ol>
<h2><span id="分库分表-水平拆分-mysql集群">分库分表 + 水平拆分 + Mysql集群</span></h2><p><img src="/2022/01/15/redis/image-20211201143245890.png" alt="image-20211201143245890"></p>
<h2><span id="如今最近的年代">如今最近的年代</span></h2><p>如今信息量井喷式增长，各种各样的数据出现（用户定位数据，图片数据等），大数据的背景下关系型数据库（RDBMS）无法满足大量数据要求。Nosql数据库就能轻松解决这些问题。目前一个基本的互联网项目：</p>
<p><img src="/2022/01/15/redis/image-20211201144846693.png" alt="image-20211201144846693"></p>
<h2><span id="为什么要用nosql">为什么要用NoSQL ？</span></h2><p>用户的个人信息，社交网络，地理位置。用户自己产生的数据，用户日志等等爆发式增长！这时候我们就需要使用NoSQL数据库的，Nosql可以很好的处理以上的情况！</p>
<h3><span id="什么是nosql">什么是Nosql</span></h3><p>NoSQL = Not Only SQL（不仅仅是SQL）</p>
<p>Not Only Structured Query Language</p>
<p>关系型数据库：列+行，同一个表下数据的结构是一样的。</p>
<p>非关系型数据库：数据存储没有固定的格式，并且可以进行横向扩展。</p>
<p>NoSQL泛指非关系型数据库，随着web2.0互联网的诞生，传统的关系型数据库很难对付web2.0时代！尤其是超大规模的高并发的社区，暴露出来很多难以克服的问题，NoSQL在当今大数据环境下发展的十分迅速，Redis是发展最快的。</p>
<h3><span id="nosql特点">Nosql特点</span></h3><p>1.方便扩展（数据之间没有关系，很好扩展！）</p>
<p>2.大数据量高性能（Redis一秒可以写8万次，读11万次，NoSQL的缓存记录级，是一种细粒度的缓存，性能会比较高！）</p>
<p>3.数据类型是多样型的！（不需要事先设计数据库，随取随用）</p>
<p>4.传统的 RDBMS 和 NoSQL</p>
<pre class=" language-tex"><code class="language-tex">传统的RDBMS(关系型数据库管理系统)
- 结构化组织
- SQL
- 数据和关系都存在单独的表中 row col
- 操作，数据定义语言
- 严格的一致性
- 基础的事务
- ...
</code></pre>
<pre class=" language-tex"><code class="language-tex">Nosql
-不仅仅是数据
-没有固定的查询语言
-键值对存储，列存储，文档存储，图形数据库（社交关系）
-最终一致性
-CAP定理和BASE
-高性能，高可用，高扩展
-...
</code></pre>
<h3><span id="3v3高">3v+3高</span></h3><p>大数据时代的3V ：主要是描述问题的</p>
<ol>
<li>海量Velume</li>
<li>多样Variety</li>
<li>实时Velocity</li>
</ol>
<p>大数据时代的3高 ： 主要是对程序的要求</p>
<ol>
<li>高并发</li>
<li>高可扩</li>
<li>高性能</li>
</ol>
<p>真正在公司中的实践：NoSQL + RDBMS 一起使用才是最强的。</p>
<h2><span id="nosql的四大分类">NoSQL的四大分类</span></h2><p><strong>kv键值对:</strong></p>
<ul>
<li>新浪：Redis</li>
<li>美团：Redis+Tair</li>
<li>阿里、百度：Redis+memecache</li>
</ul>
<p><strong>文档型数据库(bson格式和json一样)</strong></p>
<ul>
<li>MongDB(一般必须掌握)<ul>
<li>MongDB是一个基于分布式文件存储都数据库，c++编写，主要用来处理大量都文档</li>
<li>MongDB是一个基于关系型数据库和非关系型数据库都中间产品！MongDB是非关系型数据库中功能最丰富的，最像关系型数据库都数据库！</li>
</ul>
</li>
<li>ConthDB</li>
</ul>
<p><strong>列存储数据库</strong></p>
<ul>
<li>HBase</li>
<li>分布式文件系统</li>
</ul>
<p><strong>图形关系数据库</strong></p>
<ul>
<li>不是存图形，放的是关系，比如：朋友圈社交网络，广告推荐</li>
<li>Neo4j，InfoGrid</li>
</ul>
<p><img src="/2022/01/15/redis/image-20211201155955038.png" alt="image-20211201155955038"></p>
<h1><span id="redis入门">Redis入门</span></h1><h2><span id="redis是什么">Redis是什么？</span></h2><p>Redis（Remote Dictionary Server )，即远程字典服务。</p>
<p>是一个开源的使用ANSI C语言编写、支持网络、可基于内存亦可持久化的日志型、Key-Value数据库，并提供多种语言的API。</p>
<p>与memcached一样，为了保证效率，数据都是缓存在内存中。区别的是redis会周期性的把更新的数据写入磁盘或者把修改操作写入追加的记录文件，并且在此基础上实现了master-slave(主从)同步。</p>
<h2><span id="redis能干什么">Redis能干什么？</span></h2><ol>
<li>内存存储、持久化，内存是断电即失的，所以需要持久化（RDB、AOF）</li>
<li>高效率、用于高速缓冲</li>
<li>发布订阅系统</li>
<li>地图信息分析</li>
<li>计时器、计数器(eg：浏览量)</li>
<li>。。。</li>
</ol>
<h2><span id="特性">特性</span></h2><ol>
<li>多样的数据类型</li>
<li>持久化</li>
<li>集群</li>
<li>事务</li>
<li>…</li>
</ol>
<h2><span id="环境搭建略">环境搭建（略）</span></h2><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_36706878/article/details/105578816">Linux配置java环境变量_过客璇璇的博客-CSDN博客</a></p>
<p>windows:<a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1S54y1R7SB?p=8&amp;spm_id_from=pageDriver">https://www.bilibili.com/video/BV1S54y1R7SB?p=8&amp;spm_id_from=pageDriver</a></p>
<p>linux:<a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1S54y1R7SB?p=9&amp;spm_id_from=pageDriver">https://www.bilibili.com/video/BV1S54y1R7SB?p=9&amp;spm_id_from=pageDriver</a></p>
<h2><span id="性能测试">性能测试</span></h2><p><strong>redis-benchmark：</strong>Redis官方提供的性能测试工具，参数选项如下：</p>
<p><img src="/2022/01/15/redis/image-20211201170322732.png" alt="image-20211201170322732"></p>
<p>简单测试：</p>
<pre class=" language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 测试：100个并发连接 100000请求</span>
redis-benchmark -h localhost -p 6379 -c 100 -n 100000
</code></pre>
<p><img src="/2022/01/15/redis/image-20211201171126927.png" alt="image-20211201171126927"></p>
<h2><span id="基础知识">基础知识*</span></h2><p>redis默认有16个数据库</p>
<p><img src="/2022/01/15/redis/image-20211201171529597.png" alt="image-20211201171529597"></p>
<p>默认使用的第0个;</p>
<p>16个数据库为：DB 0~DB 15 默认使用DB 0 ，可以使用<code>select n</code>切换到DB n，<code>dbsize</code>可以查看当前数据库的大小，与key数量相关。</p>
<pre class=" language-bash"><code class="language-bash">127.0.0.1:6379<span class="token operator">></span> <span class="token keyword">select</span> 3 <span class="token comment" spellcheck="true">#切换数据库</span>
OK
127.0.0.1:6379<span class="token punctuation">[</span>3<span class="token punctuation">]</span><span class="token operator">></span> DBSIZE <span class="token comment" spellcheck="true">#数据库大小</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 0
<span class="token comment" spellcheck="true">#不同数据库之间 数据是不能互通的，并且dbsize 是根据库中key的个数。</span>
127.0.0.1:6379<span class="token punctuation">[</span>3<span class="token punctuation">]</span><span class="token operator">></span> <span class="token keyword">set</span> name DTXG <span class="token comment" spellcheck="true">#放入值</span>
OK
127.0.0.1:6379<span class="token punctuation">[</span>3<span class="token punctuation">]</span><span class="token operator">></span> dbsize
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 1
127.0.0.1:6379<span class="token punctuation">[</span>3<span class="token punctuation">]</span><span class="token operator">></span> <span class="token keyword">select</span> 7
OK
127.0.0.1:6379<span class="token punctuation">[</span>7<span class="token punctuation">]</span><span class="token operator">></span> get name <span class="token comment" spellcheck="true">#不能获取到别的数据库的值</span>
<span class="token punctuation">(</span>nil<span class="token punctuation">)</span>
127.0.0.1:6379<span class="token punctuation">[</span>7<span class="token punctuation">]</span><span class="token operator">></span> <span class="token keyword">select</span> 3
OK
127.0.0.1:6379<span class="token punctuation">[</span>3<span class="token punctuation">]</span><span class="token operator">></span> get name <span class="token comment" spellcheck="true">#根据key获取value</span>
<span class="token string">"DTXG"</span>
127.0.0.1:6379<span class="token punctuation">[</span>3<span class="token punctuation">]</span><span class="token operator">></span> keys * <span class="token comment" spellcheck="true">#获取数据所有的key</span>
1<span class="token punctuation">)</span> <span class="token string">"name"</span>
127.0.0.1:6379<span class="token punctuation">[</span>3<span class="token punctuation">]</span><span class="token operator">></span> flushdb <span class="token comment" spellcheck="true">#清空当前数据库</span>
OK
127.0.0.1:6379<span class="token punctuation">[</span>3<span class="token punctuation">]</span><span class="token operator">></span> keys *
<span class="token punctuation">(</span>empty list or set<span class="token punctuation">)</span>
127.0.0.1:6379<span class="token operator">></span> FLUSHALL <span class="token comment" spellcheck="true">#清空所有数据库的数据</span>
OK
127.0.0.1:6379<span class="token operator">></span> keys *
<span class="token punctuation">(</span>empty list or set<span class="token punctuation">)</span>
</code></pre>
<p><code>keys *</code> ：查看当前数据库中所有的key。</p>
<p><code>flushdb</code>：清空当前数据库中的键值对。</p>
<p><code>flushall</code>：清空所有数据库的键值对。</p>
<h2><span id="为什么redis使用6379端口">为什么Redis使用6379端口</span></h2><p><a target="_blank" rel="noopener" href="https://www.zhihu.com/question/20084750">Redis 为什么要用 6379 作为默认端口？ - 知乎 (zhihu.com)</a></p>
<blockquote>
<p><strong>Redis是单线程的</strong>，Redis是基于内存操作的。</p>
</blockquote>
<p>所以Redis的性能瓶颈不是CPU,而是机器内存和网络带宽。</p>
<p>那么为什么Redis的速度如此快呢，性能这么高呢？QPS达到10W+</p>
<blockquote>
<p>Redis为什么单线程还这么快？</p>
</blockquote>
<ul>
<li>误区1：高性能的服务器一定是多线程的？</li>
<li>误区2：多线程（CPU上下文会切换！）一定比单线程效率高！</li>
</ul>
<p>核心：Redis是将所有的数据放在内存中的，所以说使用单线程去操作效率就是最高的，多线程（CPU上下文会切换：耗时的操作！），对于内存系统来说，如果没有上下文切换效率就是最高的，多次读写都是在一个CPU上的，在内存存储数据情况下，单线程就是最佳的方案。</p>
<h1><span id="五大数据类型">五大数据类型</span></h1><p> Redis是一个开源（BSD许可），内存存储的数据结构服务器，可用作<strong>数据库，高速缓存和消息队列</strong>代理。它支持字符串、哈希表、列表、集合、有序集合，位图，hyperloglogs等数据类型。内置复制、Lua脚本、LRU收回、事务以及不同级别磁盘持久化功能，同时通过Redis Sentinel提供高可用，通过Redis Cluster提供自动分区。</p>
<h2><span id="redis-key">Redis-key*</span></h2><p>在redis中无论什么数据类型，在数据库中都是以key-value形式保存，通过进行对Redis-key的操作，来完成对数据库中数据的操作。</p>
<p>下面学习的命令：</p>
<ul>
<li><p><code>exists key</code>：判断键是否存在</p>
<pre class=" language-bash"><code class="language-bash">127.0.0.1:6379<span class="token operator">></span> exists name
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 1  <span class="token comment" spellcheck="true">#存在</span>
127.0.0.1:6379<span class="token operator">></span> exists name1
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 0
</code></pre>
</li>
<li><p><code>del key</code>：删除键值对</p>
<pre class=" language-bash"><code class="language-bash">127.0.0.1:6379<span class="token operator">></span> del age
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 1
127.0.0.1:6379<span class="token operator">></span> keys *
<span class="token punctuation">(</span>empty list or set<span class="token punctuation">)</span>
</code></pre>
</li>
<li><p><code>move key db</code>：将键值对移动到指定数据库</p>
<pre class=" language-bash"><code class="language-bash">127.0.0.1:6379<span class="token operator">></span> move name 1
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 127.0.0.1:6379<span class="token operator">></span> <span class="token keyword">select</span> 1
OK
127.0.0.1:6379<span class="token punctuation">[</span>1<span class="token punctuation">]</span><span class="token operator">></span> keys *
1<span class="token punctuation">)</span> <span class="token string">"name"</span>
</code></pre>
</li>
<li><p><code>expire key second</code>：设置键值对的过期时间</p>
<pre class=" language-bash"><code class="language-bash">127.0.0.1:6379<span class="token operator">></span> expire name 10
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 1
127.0.0.1:6379<span class="token operator">></span> ttl name <span class="token comment" spellcheck="true">#查看name的过期时间</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 8
127.0.0.1:6379<span class="token operator">></span> ttl name
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 6
127.0.0.1:6379<span class="token operator">></span> ttl name
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 2
127.0.0.1:6379<span class="token operator">></span> ttl name
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> -2 <span class="token comment" spellcheck="true">#没了</span>
127.0.0.1:6379<span class="token operator">></span> get name
<span class="token punctuation">(</span>nil<span class="token punctuation">)</span>
</code></pre>
</li>
<li><p><code>type key</code>：查看value的数据类型</p>
<pre class=" language-bash"><code class="language-bash">127.0.0.1:6379<span class="token operator">></span> <span class="token function">type</span> age
string
</code></pre>
</li>
</ul>
<p>关于TTL命令</p>
<p>Redis的key，通过TTL命令返回key的过期时间，一般来说有3种：</p>
<ol>
<li>当前key没有设置过期时间，所以会返回-1.</li>
<li>当前key有设置过期时间，而且key已经过期，所以会返回-2.</li>
<li>当前key有设置过期时间，且key还没有过期，故会返回key的正常剩余时间.</li>
</ol>
<p>关于重命名<code>RENAME</code>和<code>RENAMENX</code></p>
<ol>
<li><code>RENAME key newkey</code>修改 key 的名称</li>
<li><code>RENAMENX key newkey</code>仅当 newkey 不存在时，将 key 改名为 newkey 。</li>
</ol>
<h2><span id="string字符串">String(字符串)*</span></h2><p>普通的set、get直接略过。</p>
<p>常用命令及其示例：</p>
<p><code>APPEND key value</code>: 向指定的key的value后追加字符串/如果没有key就相当与新建一个kv</p>
<pre class=" language-bash"><code class="language-bash">127.0.0.1:6379<span class="token operator">></span> append key1 2
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 3 <span class="token comment" spellcheck="true">#字符串的长度</span>
127.0.0.1:6379<span class="token operator">></span> get key1
<span class="token string">"v12"</span>
</code></pre>
<p><code>STRLEN key</code>:    获取key保存值的字符串长度</p>
<pre class=" language-bash"><code class="language-bash">127.0.0.1:6379<span class="token operator">></span> strlen key1
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 3
</code></pre>
<p><code>DECR/INCR key</code>:    将指定key的value数值进行+1/-1(仅对于数字)</p>
<pre class=" language-bash"><code class="language-bash">127.0.0.1:6379<span class="token operator">></span> <span class="token keyword">set</span> views 0
OK
127.0.0.1:6379<span class="token operator">></span> get views
<span class="token string">"0"</span>
127.0.0.1:6379<span class="token operator">></span> incr views <span class="token comment" spellcheck="true">#+1</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 1
127.0.0.1:6379<span class="token operator">></span> get views
<span class="token string">"1"</span>
127.0.0.1:6379<span class="token operator">></span> decr views <span class="token comment" spellcheck="true">#-1</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 0
127.0.0.1:6379<span class="token operator">></span> get views
<span class="token string">"0"</span>
</code></pre>
<p><code>INCRBY/DECRBY key n</code>:    按指定的步长对数值进行加减</p>
<pre class=" language-bash"><code class="language-bash">127.0.0.1:6379<span class="token operator">></span> incrby views 10 <span class="token comment" spellcheck="true">#+10</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 10
127.0.0.1:6379<span class="token operator">></span> get views
<span class="token string">"10"</span>
127.0.0.1:6379<span class="token operator">></span> decrby views 1 <span class="token comment" spellcheck="true">#-1</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 9
127.0.0.1:6379<span class="token operator">></span> get views
<span class="token string">"9"</span>
127.0.0.1:6379<span class="token operator">></span> decrby views 4 <span class="token comment" spellcheck="true">#-4</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 5
127.0.0.1:6379<span class="token operator">></span> get views
<span class="token string">"5"</span>
127.0.0.1:6379<span class="token operator">></span> 
</code></pre>
<p><code>INCRBYFLOAT key n</code>:    为数值加上浮点型数值</p>
<pre class=" language-bash"><code class="language-bash">127.0.0.1:6379<span class="token operator">></span> incrbyfloat views 0.1 <span class="token comment" spellcheck="true">#+0.1</span>
<span class="token string">"5.1"</span>
</code></pre>
<p><code>GETRANGE key start end</code>:    按起止位置获取字符串（闭区间，起止位置都取）</p>
<pre class=" language-bash"><code class="language-bash">127.0.0.1:6379<span class="token operator">></span> getrange key1 0 3 <span class="token comment" spellcheck="true">#获取0到3的字符</span>
<span class="token string">"hell"</span>
</code></pre>
<p><code>SETRANGE key offset value</code>:用指定的value 替换key中 offset开始的值</p>
<pre class=" language-bash"><code class="language-bash">127.0.0.1:6379<span class="token operator">></span> setrange key1 1 xx <span class="token comment" spellcheck="true">#从1t</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 14
127.0.0.1:6379<span class="token operator">></span> get key1
<span class="token string">"hxxlo,everyone"</span>
</code></pre>
<p><code>SETNX key value</code>:    仅当key不存在时进行set</p>
<pre class=" language-bash"><code class="language-bash">127.0.0.1:6379<span class="token operator">></span> setnx key 123 <span class="token comment" spellcheck="true">#key不存在</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 1
127.0.0.1:6379<span class="token operator">></span> get key
<span class="token string">"123"</span>
127.0.0.1:6379<span class="token operator">></span> setnx key 456 <span class="token comment" spellcheck="true"># key已存在</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 0
127.0.0.1:6379<span class="token operator">></span> get key
<span class="token string">"123"</span>
</code></pre>
<p><code>SETEX key seconds value</code>:    set 键值对并设置过期时间</p>
<pre class=" language-bash"><code class="language-bash">127.0.0.1:6379<span class="token operator">></span> setex key2 6 123 <span class="token comment" spellcheck="true">#设置key2 值为 过期时间为6</span>
OK
127.0.0.1:6379<span class="token operator">></span> ttl key2
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 4
127.0.0.1:6379<span class="token operator">></span> ttl key2
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 3
127.0.0.1:6379<span class="token operator">></span> ttl key2
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 2
127.0.0.1:6379<span class="token operator">></span> ttl key2
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> -2
</code></pre>
<p><code>MSET key1 value1 [key2 value2..]</code>:    批量set键值对</p>
<pre class=" language-bash"><code class="language-bash">127.0.0.1:6379<span class="token operator">></span> mset k1 v1 k2 v2 k3 v3
OK
127.0.0.1:6379<span class="token operator">></span> keys *
1<span class="token punctuation">)</span> <span class="token string">"k3"</span>
2<span class="token punctuation">)</span> <span class="token string">"k2"</span>
3<span class="token punctuation">)</span> <span class="token string">"k1"</span>
</code></pre>
<p><code>MGET key1 [key2..]</code>:    批量获取多个key保存的值</p>
<pre class=" language-bash"><code class="language-bash">127.0.0.1:6379<span class="token operator">></span> mget k1 k2 k3
1<span class="token punctuation">)</span> <span class="token string">"v1"</span>
2<span class="token punctuation">)</span> <span class="token string">"v2"</span>
3<span class="token punctuation">)</span> <span class="token string">"v3"</span>
127.0.0.1:6379<span class="token operator">></span> 
</code></pre>
<p><code>MSETNX key1 value1 [key2 value2..]</code>:    批量设置键值对，仅当参数中所有的key都不存在时执行</p>
<pre class=" language-bash"><code class="language-bash">127.0.0.1:6379<span class="token operator">></span> msetnx k1 v1 k4 v4 <span class="token comment" spellcheck="true">#key都不存在才添加</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 0
127.0.0.1:6379<span class="token operator">></span> get key4 <span class="token comment" spellcheck="true">#k1存在 所以没有添加</span>
<span class="token punctuation">(</span>nil<span class="token punctuation">)</span>
</code></pre>
<p><code>GETSET key value</code>:    将给定 key 的值设为 value ，并返回 key 的旧值(old value)。</p>
<pre class=" language-java"><code class="language-java"><span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> get key1
<span class="token string">"v12"</span>
<span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> getset key1 <span class="token number">123</span> #将key1的的值设为<span class="token number">123</span> 
<span class="token string">"v12"</span> #返回旧值
<span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">:</span><span class="token number">6379</span><span class="token operator">></span> get key1
<span class="token string">"123"</span>
</code></pre>
<p><code>PSETEX key milliseconds value</code>:    和 SETEX 命令相似，但它以毫秒为单位设置 key 的生存时间</p>
<p>String类似的使用场景：value除了是字符串还可以是数字，用途举例：</p>
<ul>
<li>计数器</li>
<li>统计多单位的数量：uid:123666：follow 0</li>
<li>粉丝数</li>
<li>对象存储缓存</li>
</ul>
<h2><span id="list列表">List(列表)</span></h2><p>Redis列表是简单的字符串列表，按照插入顺序排序。你可以添加一个元素到列表的头部（左边）或者尾部（右边）</p>
<p>一个列表最多可以包含 232 - 1 个元素 (4294967295, 每个列表超过40亿个元素)。</p>
<p>首先我们列表，可以经过规则定义将其变为队列、栈、双端队列等。</p>
<p><img src="/2022/01/15/redis/image-20211201195029982.png" alt="image-20211201195029982"></p>
<p>正如图Redis中List是可以进行双端操作的，所以命令也就分为了LXXX和RLLL两类，有时候L也表示List例如LLEN</p>
<ul>
<li><code>LPUSH/RPUSH key value1[value2..]</code>从左边/右边向列表中PUSH值(一个或者多个)。</li>
<li><code>LRANGE key start end</code>    获取list 起止元素==（索引从左往右 递增）==</li>
<li><code>LPUSHX/RPUSHX key value</code>    向已存在的列名中push值（一个或者多个）</li>
<li><code>LINSERT key BEFORE|AFTER pivot value</code>    在指定列表元素的前/后 插入value</li>
<li><code>LLEN key</code>    查看列表长度</li>
<li><code>LINDEX key index</code>    通过索引获取列表元素</li>
<li><code>LSET key index value</code>    通过索引为元素设值</li>
<li><code>LPOP/RPOP key</code>    从最左边/最右边移除值 并返回</li>
<li><code>RPOPLPUSH source destination</code>    将列表的尾部(右)最后一个值弹出，并返回，然后加到另一个列表的头部</li>
<li><code>LTRIM key start end</code>    通过下标截取指定范围内的列表</li>
<li><code>LREM key count value</code>    List中是允许value重复的 count &gt; 0：从头部开始搜索 然后删除指定的value 至多删除count个 count &lt; 0：从尾部开始搜索… count = 0：删除列表中所有的指定value。</li>
<li><code>BLPOP/BRPOP key1[key2] timout</code>    移出并获取列表的第一个/最后一个元素， 如果列表没有元素会阻塞列表直到等待超时或发现可弹出元素为止。</li>
<li><code>BRPOPLPUSH source destination timeout</code>    和RPOPLPUSH功能相同，如果列表没有元素会阻塞列表直到等待超时或发现可弹出元素为止。</li>
</ul>
<p>代码示例：</p>
<pre class=" language-bash"><code class="language-bash">127.0.0.1:6379<span class="token operator">></span> lpush list one  <span class="token comment" spellcheck="true">#从左边push一个值</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 1
127.0.0.1:6379<span class="token operator">></span> lpush list two three <span class="token comment" spellcheck="true">#push多个值</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 3
127.0.0.1:6379<span class="token operator">></span> lrange list 0 -1 <span class="token comment" spellcheck="true">#获取从0到-1(全部)</span>
1<span class="token punctuation">)</span> <span class="token string">"three"</span>
2<span class="token punctuation">)</span> <span class="token string">"two"</span>
3<span class="token punctuation">)</span> <span class="token string">"one"</span>
127.0.0.1:6379<span class="token operator">></span> lrange list 0 1 <span class="token comment" spellcheck="true">#获取从0到1 倒着获取</span>
1<span class="token punctuation">)</span> <span class="token string">"three"</span>
2<span class="token punctuation">)</span> <span class="token string">"two"</span>
127.0.0.1:6379<span class="token operator">></span> rpush list right<span class="token comment" spellcheck="true">#从右边push一个值</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 4
127.0.0.1:6379<span class="token operator">></span> lrange list 0 -1 
1<span class="token punctuation">)</span> <span class="token string">"three"</span>
2<span class="token punctuation">)</span> <span class="token string">"two"</span>
3<span class="token punctuation">)</span> <span class="token string">"one"</span>
4<span class="token punctuation">)</span> <span class="token string">"right"</span>
</code></pre>
<p><img src="/2022/01/15/redis/image-20211201195952537.png" alt="image-20211201195952537"></p>
<pre class=" language-bash"><code class="language-bash">127.0.0.1:6379<span class="token operator">></span> lrange list 0 -1
1<span class="token punctuation">)</span> <span class="token string">"three"</span>
2<span class="token punctuation">)</span> <span class="token string">"two"</span>
3<span class="token punctuation">)</span> <span class="token string">"one"</span>
4<span class="token punctuation">)</span> <span class="token string">"right"</span>
127.0.0.1:6379<span class="token operator">></span> lpop list  <span class="token comment" spellcheck="true">#从左边弹出一个值 第一个(上左)</span>
<span class="token string">"three"</span>
127.0.0.1:6379<span class="token operator">></span> rpop list <span class="token comment" spellcheck="true">#从右边弹出一个值 最后一个(下右)</span>
<span class="token string">"right"</span>
</code></pre>
<pre class=" language-bash"><code class="language-bash">127.0.0.1:6379<span class="token operator">></span> lindex list 1 <span class="token comment" spellcheck="true">#获取下标1都值</span>
<span class="token string">"one"</span>
127.0.0.1:6379<span class="token operator">></span> llen list <span class="token comment" spellcheck="true">#获取list都长度</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 2

127.0.0.1:6379<span class="token operator">></span> lrange list 0 -1
1<span class="token punctuation">)</span> <span class="token string">"one"</span>
2<span class="token punctuation">)</span> <span class="token string">"two"</span>
3<span class="token punctuation">)</span> <span class="token string">"one"</span>
127.0.0.1:6379<span class="token operator">></span> lrem list 1 one <span class="token comment" spellcheck="true"># 移除1个one 从上到下</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 1
127.0.0.1:6379<span class="token operator">></span> lrange list 0 -1
1<span class="token punctuation">)</span> <span class="token string">"two"</span>
2<span class="token punctuation">)</span> <span class="token string">"one"</span>
127.0.0.1:6379<span class="token operator">></span> lrem list 2 three <span class="token comment" spellcheck="true">#移除2个three</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 0
127.0.0.1:6379<span class="token operator">></span> lrange list 0 -1
1<span class="token punctuation">)</span> <span class="token string">"two"</span>
2<span class="token punctuation">)</span> <span class="token string">"one"</span>
</code></pre>
<pre class=" language-bash"><code class="language-bash">127.0.0.1:6379<span class="token operator">></span> rpush mylist hello
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 1
127.0.0.1:6379<span class="token operator">></span> rpush mylist hello1
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 2
127.0.0.1:6379<span class="token operator">></span> rpush mylist hello2
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 3
127.0.0.1:6379<span class="token operator">></span> rpush mylist hello3
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 4
127.0.0.1:6379<span class="token operator">></span> ltrim mylist 1 2 <span class="token comment" spellcheck="true">#截取1到2</span>
OK
127.0.0.1:6379<span class="token operator">></span> lrange mylist 0 -1 
1<span class="token punctuation">)</span> <span class="token string">"hello1"</span>
2<span class="token punctuation">)</span> <span class="token string">"hello2"</span>
</code></pre>
<pre class=" language-bash"><code class="language-bash">127.0.0.1:6379<span class="token operator">></span> rpush mylist hello
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 1
127.0.0.1:6379<span class="token operator">></span> rpush mylist hello1
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 2
127.0.0.1:6379<span class="token operator">></span> rpush mylist hello2
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 3

127.0.0.1:6379<span class="token operator">></span> rpoplpush mylist myotherlist <span class="token comment" spellcheck="true">#移除mylist右边 添加到myotherlist左边</span>
<span class="token string">"hello2"</span>
127.0.0.1:6379<span class="token operator">></span> lrange mylist 0 -1
1<span class="token punctuation">)</span> <span class="token string">"hello"</span>
2<span class="token punctuation">)</span> <span class="token string">"hello1"</span>
127.0.0.1:6379<span class="token operator">></span> lrange myotherlist 0 -1
1<span class="token punctuation">)</span> <span class="token string">"hello2"</span>
</code></pre>
<pre class=" language-bash"><code class="language-bash">127.0.0.1:6379<span class="token operator">></span> exists list <span class="token comment" spellcheck="true">#判断list是否存在</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 0
127.0.0.1:6379<span class="token operator">></span> lpush list value1
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 1
127.0.0.1:6379<span class="token operator">></span> lrange list 0 -1
1<span class="token punctuation">)</span> <span class="token string">"value1"</span>
127.0.0.1:6379<span class="token operator">></span> lset list 0 item <span class="token comment" spellcheck="true">#将0索引都值设置为item</span>
OK
127.0.0.1:6379<span class="token operator">></span> lrange list 0 -1
1<span class="token punctuation">)</span> <span class="token string">"item"</span>
</code></pre>
<pre class=" language-bash"><code class="language-bash">127.0.0.1:6379<span class="token operator">></span> lpush mylist hello
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 1
127.0.0.1:6379<span class="token operator">></span> lpush mylist world
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 2
127.0.0.1:6379<span class="token operator">></span> linsert mylist before world other <span class="token comment" spellcheck="true"># 在mylist中world的前面添加一个other</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 3
127.0.0.1:6379<span class="token operator">></span> lrange mylist 0 -1
1<span class="token punctuation">)</span> <span class="token string">"other"</span>
2<span class="token punctuation">)</span> <span class="token string">"world"</span>
3<span class="token punctuation">)</span> <span class="token string">"hello"</span>
127.0.0.1:6379<span class="token operator">></span> linsert mylist after world new <span class="token comment" spellcheck="true">#在mylist中的world的后面添加一个new</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 4
127.0.0.1:6379<span class="token operator">></span> lrange mylist 0 -1
1<span class="token punctuation">)</span> <span class="token string">"other"</span>
2<span class="token punctuation">)</span> <span class="token string">"world"</span>
3<span class="token punctuation">)</span> <span class="token string">"new"</span>
4<span class="token punctuation">)</span> <span class="token string">"hello"</span>
127.0.0.1:6379<span class="token operator">></span> 
</code></pre>
<h3><span id="小结">小结</span></h3><ul>
<li>list实际上是一个链表，before Node after , left, right 都可以插入值</li>
<li>如果key不存在，则创建新的链表</li>
<li>如果key存在，新增内容</li>
<li>如果移除了所有值，空链表，也代表不存在</li>
<li>在两边插入或者改动值，效率最高！修改中间元素，效率相对较低</li>
</ul>
<p>应用：</p>
<p>消息排队！消息队列（Lpush Rpop）,栈（Lpush Lpop）</p>
<h2><span id="set集合">Set(集合）</span></h2><p>Redis的Set是string类型的无序集合。集合成员是唯一的，这就意味着集合中不能出现重复的数据。</p>
<p>Redis中集合是通过哈希表实现的，所以添加，删除，查找的复杂度都是O(1)。</p>
<p>集合中最大的成员数为 232 - 1 (4294967295, 每个集合可存储40多亿个成员)。</p>
<ul>
<li><code>SADD key member1[member2..]</code>    向集合中无序增加一个/多个成员</li>
<li><code>SMEMBERS key</code>    返回集合中所有的成员</li>
</ul>
<pre class=" language-bash"><code class="language-bash">127.0.0.1:6379<span class="token operator">></span> sadd myset hello <span class="token comment" spellcheck="true">#往set集合放入hello</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 1
127.0.0.1:6379<span class="token operator">></span> sadd myset love <span class="token comment" spellcheck="true">#往set集合放入love</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 1
127.0.0.1:6379<span class="token operator">></span> sadd myset <span class="token function">lpc</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 1
127.0.0.1:6379<span class="token operator">></span> smembers myset <span class="token comment" spellcheck="true">#返回集合中所有的成员</span>
1<span class="token punctuation">)</span> <span class="token string">"love"</span>
2<span class="token punctuation">)</span> <span class="token string">"lpc"</span>
3<span class="token punctuation">)</span> <span class="token string">"hello"</span>
127.0.0.1:6379<span class="token operator">></span> sismember myset hello <span class="token comment" spellcheck="true">#set中是否存在hello</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 1  <span class="token comment" spellcheck="true">#存在</span>
127.0.0.1:6379<span class="token operator">></span> sismember myset world
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 0
</code></pre>
<ul>
<li><code>SCARD key</code>    获取集合的成员数</li>
<li><code>SREM key member1[member2..]</code>    移除集合中一个/多个成员</li>
<li><code>SRANDMEMBER key [count]</code>    随机返回集合中count个成员，count缺省值为1</li>
<li><code>SPOP key [count]</code>    随机移除并返回集合中count个成员，count缺省值为1</li>
</ul>
<pre class=" language-bash"><code class="language-bash">127.0.0.1:6379<span class="token operator">></span> scard myset <span class="token comment" spellcheck="true">#返回set集合的个数</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 3
127.0.0.1:6379<span class="token operator">></span> srem myset hello <span class="token comment" spellcheck="true">#移除一个元素</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 1
127.0.0.1:6379<span class="token operator">></span> scard myset
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 2
127.0.0.1:6379<span class="token operator">></span> smembers myset
1<span class="token punctuation">)</span> <span class="token string">"love"</span>
2<span class="token punctuation">)</span> <span class="token string">"lpc"</span>
127.0.0.1:6379<span class="token operator">></span> srandmember myset <span class="token comment" spellcheck="true"># 随机获取一个元素 默认一个</span>
<span class="token string">"love"</span>
127.0.0.1:6379<span class="token operator">></span> srandmember myset
<span class="token string">"lpc"</span>
127.0.0.1:6379<span class="token operator">></span> spop myset <span class="token comment" spellcheck="true">#随机移除一个元素</span>
<span class="token string">"love"</span>
127.0.0.1:6379<span class="token operator">></span> spop myset
<span class="token string">"lpc2"</span>
127.0.0.1:6379<span class="token operator">></span> smembers myset
1<span class="token punctuation">)</span> <span class="token string">"lpc"</span>
</code></pre>
<ul>
<li><code>SMOVE source destination member</code>    将source集合的成员member移动到destination集合</li>
</ul>
<pre class=" language-bash"><code class="language-bash">127.0.0.1:6379<span class="token operator">></span> sadd myset hello
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 1
127.0.0.1:6379<span class="token operator">></span> sadd myset world
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 1
127.0.0.1:6379<span class="token operator">></span> sadd myset <span class="token function">lpc</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 1
127.0.0.1:6379<span class="token operator">></span> sadd myset2 set2
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 1
127.0.0.1:6379<span class="token operator">></span> smove myset myset2 <span class="token function">lpc</span> <span class="token comment" spellcheck="true">#myset移除lpc到myset2</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 1
127.0.0.1:6379<span class="token operator">></span> smembers myset
1<span class="token punctuation">)</span> <span class="token string">"world"</span>
2<span class="token punctuation">)</span> <span class="token string">"hello"</span>
127.0.0.1:6379<span class="token operator">></span> smembers myset2
1<span class="token punctuation">)</span> <span class="token string">"set2"</span>
2<span class="token punctuation">)</span> <span class="token string">"lpc"</span>
</code></pre>
<ul>
<li><code>SDIFF key1[key2..]</code>    返回所有集合的差集 key1- key2 - …</li>
<li><code>SDIFFSTORE destination key1[key2..]</code>    在SDIFF的基础上，将结果保存到集合中==(覆盖)==。不能保存到其他类型key噢！</li>
<li><code>SINTER key1 [key2..]</code>    返回所有集合的交集</li>
<li><code>SINTERSTORE destination key1[key2..]</code>    在SINTER的基础上，存储结果到集合中。覆盖</li>
<li><code>SUNION key1 [key2..]</code>    返回所有集合的并集</li>
<li><code>SUNIONSTORE destination key1 [key2..]</code>    在SUNION的基础上，存储结果到及和张。覆盖</li>
</ul>
<pre class=" language-bash"><code class="language-bash">127.0.0.1:6379<span class="token operator">></span> sadd key1 a
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 1
127.0.0.1:6379<span class="token operator">></span> sadd key1 b
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 1
127.0.0.1:6379<span class="token operator">></span> sadd key1 c
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 1
127.0.0.1:6379<span class="token operator">></span> sadd key2 c
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 1
127.0.0.1:6379<span class="token operator">></span> sadd key2 d
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 1
127.0.0.1:6379<span class="token operator">></span> sadd key2 e
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 1
127.0.0.1:6379<span class="token operator">></span> <span class="token function">sdiff</span> key1 key2<span class="token comment" spellcheck="true">#key1和key2的差集 key1-key2</span>
1<span class="token punctuation">)</span> <span class="token string">"a"</span>
2<span class="token punctuation">)</span> <span class="token string">"b"</span>
127.0.0.1:6379<span class="token operator">></span> sinter key1 key2<span class="token comment" spellcheck="true">#key1和key2的交集</span>
1<span class="token punctuation">)</span> <span class="token string">"c"</span>
127.0.0.1:6379<span class="token operator">></span> sunion key1 key2 <span class="token comment" spellcheck="true">#key1和key2的并集</span>
1<span class="token punctuation">)</span> <span class="token string">"b"</span>
2<span class="token punctuation">)</span> <span class="token string">"c"</span>
3<span class="token punctuation">)</span> <span class="token string">"a"</span>
4<span class="token punctuation">)</span> <span class="token string">"e"</span>
5<span class="token punctuation">)</span> <span class="token string">"d"</span>
</code></pre>
<ul>
<li><code>SSCAN KEY [MATCH pattern] [COUNT count]</code>    在大量数据环境下，使用此命令遍历集合中元素，每次遍历部分</li>
</ul>
<h2><span id="hash哈希">Hash（哈希）</span></h2><p>Redis hash 是一个string类型的field和value的映射表，hash特别适合用于存储对象。</p>
<p>Set就是一种简化的Hash,只变动key,而value使用默认值填充。可以将一个Hash表作为一个对象进行存储，表中存放对象的信息。</p>
<p>key value (k-v)</p>
<ul>
<li><code>HSET key field value</code>    将哈希表 key 中的字段 field 的值设为 value 。重复设置同一个field会覆盖,返回0</li>
<li><code>HMSET key field1 value1 [field2 value2..]</code>    同时将多个 field-value (域-值)对设置到哈希表 key 中。</li>
<li><code>HGET key field value</code>    获取存储在哈希表中指定字段的值</li>
<li><code>HMGET key field1 [field2..]</code>    获取所有给定字段的值</li>
<li><code>HGETALL key</code>    获取在哈希表key 的所有字段和值</li>
</ul>
<pre class=" language-bash"><code class="language-bash">127.0.0.1:6379<span class="token operator">></span> hset myhash field <span class="token function">lpc</span> <span class="token comment" spellcheck="true">#set一个hash类型的表 key为myhash value为field lpc</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 1
127.0.0.1:6379<span class="token operator">></span> hget myhash field <span class="token comment" spellcheck="true">#获取一个元素 </span>
<span class="token string">"lpc"</span>
127.0.0.1:6379<span class="token operator">></span> hmset myhash field hello field2 world <span class="token comment" spellcheck="true">#插入多个元素</span>
OK
127.0.0.1:6379<span class="token operator">></span> hmget myhash field field2 <span class="token comment" spellcheck="true">#获取多个元素</span>
1<span class="token punctuation">)</span> <span class="token string">"hello"</span>
2<span class="token punctuation">)</span> <span class="token string">"world"</span>
127.0.0.1:6379<span class="token operator">></span> hgetall myhash <span class="token comment" spellcheck="true">#获取myhash表全部元素</span>
1<span class="token punctuation">)</span> <span class="token string">"field"</span>
2<span class="token punctuation">)</span> <span class="token string">"hello"</span>
3<span class="token punctuation">)</span> <span class="token string">"field2"</span>
4<span class="token punctuation">)</span> <span class="token string">"world"</span>
</code></pre>
<ul>
<li><code>HDEL key field1 [field2..]</code>    删除哈希表key中一个/多个field字段</li>
</ul>
<pre class=" language-bash"><code class="language-bash">127.0.0.1:6379<span class="token operator">></span> hdel myhash field <span class="token comment" spellcheck="true">#删除一个key中的元素的值</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 1
127.0.0.1:6379<span class="token operator">></span> hget myhash field
<span class="token punctuation">(</span>nil<span class="token punctuation">)</span>
</code></pre>
<ul>
<li><code>HLEN key</code>    获取哈希表中字段的数量</li>
<li><code>HEXISTS key field</code>    查看哈希表 key 中，指定的字段是否存在。</li>
</ul>
<pre class=" language-bash"><code class="language-bash">127.0.0.1:6379<span class="token operator">></span> hlen myhash<span class="token comment" spellcheck="true">#获取myhash表中的元素</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 1 
127.0.0.1:6379<span class="token operator">></span> hexists myhash field3 <span class="token comment" spellcheck="true">#判断myhash中field3是否存在</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 0
</code></pre>
<ul>
<li><code>HKEYS key</code>    获取哈希表key中所有的字段</li>
<li><code>HVALS key</code>    获取哈希表中所有值</li>
</ul>
<pre class=" language-bash"><code class="language-bash">127.0.0.1:6379<span class="token operator">></span> hkeys myhash <span class="token comment" spellcheck="true">#获取myhash表中的所有key</span>
1<span class="token punctuation">)</span> <span class="token string">"field2"</span>
2<span class="token punctuation">)</span> <span class="token string">"field1"</span>
127.0.0.1:6379<span class="token operator">></span> hvals myhash <span class="token comment" spellcheck="true">#获取myhash中所有的values</span>
1<span class="token punctuation">)</span> <span class="token string">"world"</span>
2<span class="token punctuation">)</span> <span class="token string">"hello"</span>
</code></pre>
<ul>
<li><code>HINCRBY key field n</code>    为哈希表 key 中的指定字段的整数值加上增量n，并返回增量后结果 一样只适用于整数型字段</li>
</ul>
<pre class=" language-bash"><code class="language-bash">127.0.0.1:6379<span class="token operator">></span> hset myhash field3 5
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 1
127.0.0.1:6379<span class="token operator">></span> hincrby myhash field3 5 <span class="token comment" spellcheck="true">#给myhash表中field3增加5</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 10
127.0.0.1:6379<span class="token operator">></span> hget myhash field3
<span class="token string">"10"</span>
127.0.0.1:6379<span class="token operator">></span> hsetnx myhash field4 nihao <span class="token comment" spellcheck="true">#myhash中如果不存在就添加一个field4 nihao</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 1
127.0.0.1:6379<span class="token operator">></span> hsetnx myhash field4 nihao
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 0
</code></pre>
<ul>
<li><p><code>HINCRBYFLOAT key field n</code>    为哈希表 key 中的指定字段的浮点数值加上增量 n。</p>
</li>
<li><p><code>HSCAN key cursor [MATCH pattern] [COUNT count]</code>    迭代哈希表中的键值对。</p>
</li>
</ul>
<p> Hash变更的数据user name age，尤其是用户信息之类的，经常变动的信息！Hash更适合于对象的存储，Sring更加适合字符串存储！</p>
<h2><span id="zset有序集合">Zset（有序集合）</span></h2><p>不同的是每个元素都会关联一个double类型的分数（score）。redis正是通过分数来为集合中的成员进行从小到大的排序。</p>
<p>score相同：按字典顺序排序</p>
<p>有序集合的成员是唯一的,但分数(score)却可以重复。</p>
<ul>
<li><code>ZADD key score member1 [score2 member2]</code>    向有序集合添加一个或多个成员，或者更新已存在成员的分数</li>
<li><code>ZRANGE key start end</code>    通过索引区间返回有序集合成指定区间内的成员</li>
</ul>
<pre class=" language-bash"><code class="language-bash">127.0.0.1:6379<span class="token operator">></span> zadd myset 1 one <span class="token comment" spellcheck="true">#添加一个元素分数为1</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 1
127.0.0.1:6379<span class="token operator">></span> zadd myset 2 two
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 1
127.0.0.1:6379<span class="token operator">></span> zadd myset 3 three 4 four<span class="token comment" spellcheck="true">#多次添加元素指定分数</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 2
127.0.0.1:6379<span class="token operator">></span> zrange myset 0 -1 <span class="token comment" spellcheck="true">#获取myset的0到-1的元素</span>
1<span class="token punctuation">)</span> <span class="token string">"one"</span>
2<span class="token punctuation">)</span> <span class="token string">"two"</span>
3<span class="token punctuation">)</span> <span class="token string">"three"</span>
4<span class="token punctuation">)</span> <span class="token string">"four"</span>
</code></pre>
<ul>
<li><code>ZRANGEBYSCORE key min max</code>    通过分数返回有序集合指定区间内的成员==-inf 和 +inf分别表示最小最大值，只支持开区间()==</li>
</ul>
<pre class=" language-bash"><code class="language-bash">127.0.0.1:6379<span class="token operator">></span> zadd salary 25000 xiaohong
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 1
127.0.0.1:6379<span class="token operator">></span> zadd salary 5000 zhangsan
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 1
127.0.0.1:6379<span class="token operator">></span> zadd salary 500 <span class="token function">lpc</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 1
127.0.0.1:6379<span class="token operator">></span> zrangebyscore salary -inf +inf <span class="token comment" spellcheck="true">#从小到大根据分数排序</span>
1<span class="token punctuation">)</span> <span class="token string">"lpc"</span>
2<span class="token punctuation">)</span> <span class="token string">"zhangsan"</span>
3<span class="token punctuation">)</span> <span class="token string">"xiaohong"</span>
127.0.0.1:6379<span class="token operator">></span> zrangebyscore salary -inf +inf withscores<span class="token comment" spellcheck="true">#从小到大根据分数排序，显示分数</span>
1<span class="token punctuation">)</span> <span class="token string">"lpc"</span>
2<span class="token punctuation">)</span> <span class="token string">"500"</span>
3<span class="token punctuation">)</span> <span class="token string">"zhangsan"</span>
4<span class="token punctuation">)</span> <span class="token string">"5000"</span>
5<span class="token punctuation">)</span> <span class="token string">"xiaohong"</span>
6<span class="token punctuation">)</span> <span class="token string">"25000"</span>
127.0.0.1:6379<span class="token operator">></span> zrangebyscore salary -inf 2500 withscores<span class="token comment" spellcheck="true">#从小到2500根据分数排序，显示分数</span>
1<span class="token punctuation">)</span> <span class="token string">"lpc"</span>
2<span class="token punctuation">)</span> <span class="token string">"500"</span>
</code></pre>
<ul>
<li><code>ZREM key member1 [member2..]</code>    移除有序集合中一个/多个成员</li>
<li><code>ZCARD key</code>    获取有序集合的成员数</li>
<li><code>ZREVRANGE key start end</code>    返回有序集中指定区间内的成员，通过索引，分数从高到底</li>
</ul>
<pre class=" language-bash"><code class="language-bash">127.0.0.1:6379<span class="token operator">></span> <span class="token function">clear</span>
127.0.0.1:6379<span class="token operator">></span> zrange salary 0 -1
1<span class="token punctuation">)</span> <span class="token string">"lpc"</span>
2<span class="token punctuation">)</span> <span class="token string">"zhangsan"</span>
3<span class="token punctuation">)</span> <span class="token string">"xiaohong"</span>
127.0.0.1:6379<span class="token operator">></span> zrem salary xiaohong <span class="token comment" spellcheck="true">#移除一个元素</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 1
127.0.0.1:6379<span class="token operator">></span> zrange salary 0 -1
1<span class="token punctuation">)</span> <span class="token string">"lpc"</span>
2<span class="token punctuation">)</span> <span class="token string">"zhangsan"</span>
127.0.0.1:6379<span class="token operator">></span> zcard salary <span class="token comment" spellcheck="true">#大小</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 2
127.0.0.1:6379<span class="token operator">></span> zrevrange salary 0 -1<span class="token comment" spellcheck="true">#从大到小</span>
1<span class="token punctuation">)</span> <span class="token string">"zhangsan"</span>
2<span class="token punctuation">)</span> <span class="token string">"lpc"</span>
</code></pre>
<ul>
<li><code>ZCOUNT key min max</code>    计算在有序集合中指定区间score的成员数</li>
</ul>
<pre class=" language-bash"><code class="language-bash">127.0.0.1:6379<span class="token operator">></span> zadd myset 1 hello
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 1
127.0.0.1:6379<span class="token operator">></span> zadd myset 2 word 3 <span class="token function">lpc</span> 
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 2
127.0.0.1:6379<span class="token operator">></span> zcount myset 1 3<span class="token comment" spellcheck="true">#获取1到3的数量</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 3
127.0.0.1:6379<span class="token operator">></span> zcount myset 1 2<span class="token comment" spellcheck="true">#获取1到2的数量</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 2
</code></pre>
<p>更多api访问<a target="_blank" rel="noopener" href="https://www.cnblogs.com/kylinxxx/p/13770063.html">https://www.cnblogs.com/kylinxxx/p/13770063.html</a></p>
<p>应用案例：</p>
<ol>
<li>set排序 存储班级成绩表 工资表排序！</li>
<li>普通消息，1.重要消息 2.带权重进行判断</li>
<li>排行榜应用实现，取Top N测试</li>
</ol>
<h1><span id="三种特殊数据类型">三种特殊数据类型</span></h1><h2><span id="geospatial地理位置">Geospatial(地理位置)</span></h2><p>朋友的定位，附近的人，打车计算距离？</p>
<p>Redis的Geo在3.2版本就推出了！这个功能可以推算地理位置的信息，两地之间的距离，方圆几里的人！</p>
<p>经纬度查询：<a target="_blank" rel="noopener" href="http://www.jsons.cn/lngcode/">http://www.jsons.cn/lngcode/</a></p>
<p><img src="/2022/01/15/redis/image-20211202163115193.png" alt="image-20211202163115193"></p>
<h3><span id="有效经纬度">有效经纬度</span></h3><ul>
<li>有效的经度从-180度到180度。</li>
<li>有效的纬度从-85.05112878度到85.05112878度。</li>
</ul>
<blockquote>
<h2><span id="geoadd">geoadd</span></h2></blockquote>
<p>使用经纬度定位地理坐标并用一个有序集合zset保存，所以zset命令也可以使用</p>
<ul>
<li><code>geoadd key longitud(经度) latitude(纬度) member [..]</code>    将具体经纬度的坐标存入一个有序集合</li>
</ul>
<pre class=" language-bash"><code class="language-bash">127.0.0.1:6379<span class="token operator">></span> geoadd china:city 116.40 39.90 beijing
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 1
127.0.0.1:6379<span class="token operator">></span> geoadd china:city 121.47 31.23 shanghai
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 1
127.0.0.1:6379<span class="token operator">></span> geoadd china:city 106.50 29.53 chongqing
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 1
127.0.0.1:6379<span class="token operator">></span> geoadd china:city 114.08 22.54 shenzhen
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 1
</code></pre>
<blockquote>
<h2><span id="geopos">GEOPOS</span></h2></blockquote>
<ul>
<li><code>geopos key member [member..]</code>    获取集合中的一个/多个成员坐标</li>
</ul>
<pre class=" language-bash"><code class="language-bash">127.0.0.1:6379<span class="token operator">></span> geopos china:city beijing shanghai chongqing shenzhen<span class="token comment" spellcheck="true">#获取key得经度和纬度</span>
1<span class="token punctuation">)</span> 1<span class="token punctuation">)</span> <span class="token string">"116.39999896287918091"</span>
   2<span class="token punctuation">)</span> <span class="token string">"39.90000009167092543"</span>
2<span class="token punctuation">)</span> 1<span class="token punctuation">)</span> <span class="token string">"121.47000163793563843"</span>
   2<span class="token punctuation">)</span> <span class="token string">"31.22999903975783553"</span>
3<span class="token punctuation">)</span> 1<span class="token punctuation">)</span> <span class="token string">"106.49999767541885376"</span>
   2<span class="token punctuation">)</span> <span class="token string">"29.52999957900659211"</span>
4<span class="token punctuation">)</span> 1<span class="token punctuation">)</span> <span class="token string">"114.08000081777572632"</span>
   2<span class="token punctuation">)</span> <span class="token string">"22.53999903789756587"</span>
</code></pre>
<blockquote>
<h2><span id="geodist">GEODIST</span></h2></blockquote>
<p>指定单位的参数 unit 必须是以下单位的其中一个：</p>
<p>m 表示单位为米。</p>
<p>km 表示单位为千米。</p>
<p>mi 表示单位为英里。</p>
<p>ft 表示单位为英尺。</p>
<ul>
<li><code>geodist key member1 member2 [unit]</code>    返回两个给定位置之间的距离。默认以米作为单位。</li>
</ul>
<pre class=" language-bash"><code class="language-bash">127.0.0.1:6379<span class="token operator">></span> geodist china:city beijing chongqing 
<span class="token string">"1464070.8051"</span>
127.0.0.1:6379<span class="token operator">></span> geodist china:city beijing shanghai km
<span class="token string">"1067.3788"</span>
</code></pre>
<blockquote>
<h2><span id="georadius">GEORADIUS</span></h2></blockquote>
<p>我附近都人？(获得附近的人的地址，定位！)通过半径查询！</p>
<h3><span id="关于georadius的参数">关于GEORADIUS的参数</span></h3><p>通过georadius就可以完成 附近的人功能</p>
<p>withcoord:带上坐标</p>
<p>withdist:带上距离，单位与半径单位相同</p>
<p>COUNT n : 只显示前n个(按距离递增排序)</p>
<ul>
<li><code>georadius key longitude latitude radius m|km|mi|ft [WITHCOORD][WITHDIST] [WITHHASH] [COUNT count]</code>    以给定的经纬度为中心， 返回集合包含的位置元素当中， 与中心的距离不超过给定最大距离的所有位置元素。</li>
</ul>
<p>指定地点定位：用于个人</p>
<pre class=" language-bash"><code class="language-bash">127.0.0.1:6379<span class="token operator">></span> georadius china:city 110 30 1000 km<span class="token comment" spellcheck="true">#以110 30经纬度为中心1000km为半径查询所有</span>
1<span class="token punctuation">)</span> <span class="token string">"chongqing"</span>
2<span class="token punctuation">)</span> <span class="token string">"shenzhen"</span>
127.0.0.1:6379<span class="token operator">></span> georadius china:city 110 30 500 km
1<span class="token punctuation">)</span> <span class="token string">"chongqing"</span>
127.0.0.1:6379<span class="token operator">></span> georadius china:city 110 30 1000 km withdist withcoord count 1<span class="token comment" spellcheck="true">#指定1个</span>
1<span class="token punctuation">)</span> 1<span class="token punctuation">)</span> <span class="token string">"chongqing"</span>
   2<span class="token punctuation">)</span> <span class="token string">"341.9374"</span>
   3<span class="token punctuation">)</span> 1<span class="token punctuation">)</span> <span class="token string">"106.49999767541885376"</span>
      2<span class="token punctuation">)</span> <span class="token string">"29.52999957900659211"</span>
127.0.0.1:6379<span class="token operator">></span> georadius china:city 110 30 1000 km withdist withcoord count 2
1<span class="token punctuation">)</span> 1<span class="token punctuation">)</span> <span class="token string">"chongqing"</span>
   2<span class="token punctuation">)</span> <span class="token string">"341.9374"</span>
   3<span class="token punctuation">)</span> 1<span class="token punctuation">)</span> <span class="token string">"106.49999767541885376"</span>
      2<span class="token punctuation">)</span> <span class="token string">"29.52999957900659211"</span>
2<span class="token punctuation">)</span> 1<span class="token punctuation">)</span> <span class="token string">"shenzhen"</span>
   2<span class="token punctuation">)</span> <span class="token string">"923.9364"</span>
   3<span class="token punctuation">)</span> 1<span class="token punctuation">)</span> <span class="token string">"114.08000081777572632"</span>
      2<span class="token punctuation">)</span> <span class="token string">"22.53999903789756587"</span>
127.0.0.1:6379<span class="token operator">></span> 
</code></pre>
<blockquote>
<h2><span id="georadiusbymember">GEORADIUSBYMEMBER</span></h2></blockquote>
<ul>
<li><code>GEORADIUSBYMEMBER key member radius...</code>    功能与GEORADIUS相同，只是中心位置不是具体的经纬度，而是使用结合中已有的成员作为中心点。</li>
</ul>
<p>城市定位</p>
<pre class=" language-bash"><code class="language-bash">127.0.0.1:6379<span class="token operator">></span> georadiusbymember china:city beijing 1000 km
1<span class="token punctuation">)</span> <span class="token string">"beijing"</span>
127.0.0.1:6379<span class="token operator">></span> georadiusbymember china:city beijing 5000 km
1<span class="token punctuation">)</span> <span class="token string">"chongqing"</span>
2<span class="token punctuation">)</span> <span class="token string">"shenzhen"</span>
3<span class="token punctuation">)</span> <span class="token string">"shanghai"</span>
4<span class="token punctuation">)</span> <span class="token string">"beijing"</span>
</code></pre>
<blockquote>
<h2><span id="geohash">GEOHASH</span></h2></blockquote>
<ul>
<li><code>geohash key member1 [member2..]</code>    返回一个或多个位置元素的Geohash表示。使用Geohash位置52点整数编码。</li>
</ul>
<pre class=" language-bash"><code class="language-bash">127.0.0.1:6379<span class="token operator">></span> geohash china:city beijing chongqing <span class="token comment" spellcheck="true">#将经纬转为字符串</span>
<span class="token comment" spellcheck="true">#两个字符串越接近 两地越近</span>
1<span class="token punctuation">)</span> <span class="token string">"wx4fbxxfke0"</span>
2<span class="token punctuation">)</span> <span class="token string">"wm5xzrybty0"</span>
</code></pre>
<blockquote>
<p>GEO底层实现原理其实就是zset，我们可以使用zset来操作GEO!</p>
</blockquote>
<pre class=" language-bash"><code class="language-bash">127.0.0.1:6379<span class="token operator">></span> zrange china:city 0 -1
1<span class="token punctuation">)</span> <span class="token string">"chongqing"</span>
2<span class="token punctuation">)</span> <span class="token string">"shenzhen"</span>
3<span class="token punctuation">)</span> <span class="token string">"shanghai"</span>
4<span class="token punctuation">)</span> <span class="token string">"beijing"</span>
127.0.0.1:6379<span class="token operator">></span> zrem china:city beijing 
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 1
127.0.0.1:6379<span class="token operator">></span> zrange china:city 0 -1
1<span class="token punctuation">)</span> <span class="token string">"chongqing"</span>
2<span class="token punctuation">)</span> <span class="token string">"shenzhen"</span>
3<span class="token punctuation">)</span> <span class="token string">"shanghai"</span>
</code></pre>
<h2><span id="hyperloglog基数统计">Hyperloglog(基数统计)</span></h2><p>Redis HyperLogLog 是用来做基数统计的算法，HyperLogLog 的优点是，在输入元素的数量或者体积非常非常大时，计算基数所需的空间总是固定的、并且是很小的。</p>
<p>花费 12 KB 内存，就可以计算接近 2^64 个不同元素的基数。</p>
<p>因为 HyperLogLog 只会根据输入元素来计算基数，而不会储存输入元素本身，所以 HyperLogLog 不能像集合那样，返回输入的各个元素。</p>
<p>其底层使用string数据类型。</p>
<h3><span id="什么是基数">什么是基数？</span></h3><p>数据集中不重复的元素的个数。</p>
<h3><span id="应用场景">应用场景：</span></h3><p>网页的访问量（UV）：一个用户多次访问，也只能算作一个人。</p>
<p>传统实现，存储用户的id,然后每次进行比较。当用户变多之后这种方式及其浪费空间，而我们的目的只是计数，Hyperloglog就能帮助我们利用最小的空间完成。</p>
<ul>
<li><p><code>PFADD key element1 [elememt2..]</code>    添加指定元素到 HyperLogLog中</p>
</li>
<li><p><code>PFCOUNT key [key]</code>    返回给定 HyperLogLog 的基数估算值。</p>
</li>
<li><p><code>PFMERGE destkey sourcekey [sourcekey..]</code>    将多个 HyperLogLog 合并为一个 HyperLogLog</p>
<pre class=" language-bash"><code class="language-bash">----------pfadd--pfcount---------------------
127.0.0.1:6379<span class="token operator">></span> pfadd mykey a  b c d e f g h i j <span class="token comment" spellcheck="true">#添加元素到mykey</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 1
127.0.0.1:6379<span class="token operator">></span> pfcount mykey <span class="token comment" spellcheck="true">#统计数量</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 10
127.0.0.1:6379<span class="token operator">></span> pfadd mykey2 i j z x c <span class="token function">v</span> b n m<span class="token comment" spellcheck="true">#添加元素到mykey2</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 1
127.0.0.1:6379<span class="token operator">></span> pfcount mykey2<span class="token comment" spellcheck="true">#统计数量</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 9
----------------pfmerge-----------------------
127.0.0.1:6379<span class="token operator">></span> pfmerge mykey3 mykey mykey2 <span class="token comment" spellcheck="true">#把mykey，mykey2的元素添加到mykey3</span>
OK
127.0.0.1:6379<span class="token operator">></span> pfcount mykey3 <span class="token comment" spellcheck="true">#统计数量</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 15 <span class="token comment" spellcheck="true">#交集 mykey和mykey2右4个重复</span>
</code></pre>
</li>
</ul>
<h2><span id="bitmap位图">BitMap(位图)</span></h2><p>使用位存储，信息状态只有 0 和 1</p>
<p>Bitmap是一串连续的2进制数字（0或1），每一位所在的位置为偏移(offset)，在bitmap上可执行AND,OR,XOR,NOT以及其它位操作。</p>
<p>应用场景: 签到统计、状态统计</p>
<ul>
<li><code>setbit key offset value</code>    为指定key的offset位设置值</li>
<li><code>getbit key offset</code>    获取offset位的值</li>
<li><code>bitcount key [start end]</code>    统计字符串被设置为1的bit数，也可以指定统计范围按字节</li>
</ul>
<pre class=" language-bash"><code class="language-bash">------------setbit--getbit--------------
127.0.0.1:6379<span class="token operator">></span> setbit sign 0 1<span class="token comment" spellcheck="true">#周一打卡了</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 0
127.0.0.1:6379<span class="token operator">></span> setbit sign 1 0<span class="token comment" spellcheck="true">#周二没有打卡</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 0
127.0.0.1:6379<span class="token operator">></span> setbit sign 2 0<span class="token comment" spellcheck="true">#周二没有打卡</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 0
127.0.0.1:6379<span class="token operator">></span> setbit sign 3 1<span class="token comment" spellcheck="true">#周四打卡了</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 0
127.0.0.1:6379<span class="token operator">></span> setbit sign 4 1<span class="token comment" spellcheck="true">#周五打卡了</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 0
127.0.0.1:6379<span class="token operator">></span> setbit sign 5 0<span class="token comment" spellcheck="true">#周六没有打卡</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 0
127.0.0.1:6379<span class="token operator">></span> setbit sign 6 0<span class="token comment" spellcheck="true">#周日没有打卡</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 0
<span class="token comment" spellcheck="true">#获取offset位的值</span>
127.0.0.1:6379<span class="token operator">></span> getbit sign 4<span class="token comment" spellcheck="true">#获取周五是否打卡</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 1
-----------bitcount----------------------------
127.0.0.1:6379<span class="token operator">></span> bitcount sign <span class="token comment" spellcheck="true">#打卡天数</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 3
</code></pre>
<ul>
<li><code>bitop operration destkey key[key..]</code>    对一个或多个保存二进制位的字符串 key 进行位元操作，并将结果保存到 destkey 上。</li>
<li><code>BITPOS key bit [start] [end]</code>    返回字符串里面第一个被设置为1或者0的bit位。start和end只能按字节,不能按位</li>
</ul>
<h1><span id="事务">事务</span></h1><p>Redis的单条命令是保证原子性的，<strong>但是redis事务不能保证原子性</strong></p>
<pre class=" language-tex"><code class="language-tex">Redis事务本质：一组命令的集合。

----------------- 队列 set set set 执行 -------------------

事务中每条命令都会被序列化，执行过程中按顺序执行，不允许其他命令进行干扰。

一次性

顺序性

排他性

Redis事务没有隔离级别的概念

Redis单条命令是保证原子性的，但是redis事务不保证原子性！
</code></pre>
<p>Redis事务操作过程</p>
<ul>
<li>开启事务（multi）</li>
<li>命令入队</li>
<li>执行事务（exec）</li>
</ul>
<p>所以事务中的命令在加入时都没有被执行，直到提交时才会开始执行(Exec)一次性完成。</p>
<h2><span id="正常执行">正常执行</span></h2><pre class=" language-bash"><code class="language-bash">127.0.0.1:6379<span class="token operator">></span> multi<span class="token comment" spellcheck="true"># 开启事务</span>
OK
127.0.0.1:6379<span class="token operator">></span> <span class="token keyword">set</span> k1 v1<span class="token comment" spellcheck="true"># 命令入队</span>
QUEUED
127.0.0.1:6379<span class="token operator">></span> <span class="token keyword">set</span> k2 v2
QUEUED
127.0.0.1:6379<span class="token operator">></span> get k2
QUEUED
127.0.0.1:6379<span class="token operator">></span> <span class="token keyword">set</span> k3 v3
QUEUED
127.0.0.1:6379<span class="token operator">></span> <span class="token function">exec</span><span class="token comment" spellcheck="true"># 事务执行</span>
1<span class="token punctuation">)</span> OK
2<span class="token punctuation">)</span> OK
3<span class="token punctuation">)</span> <span class="token string">"v2"</span>
4<span class="token punctuation">)</span> OK
</code></pre>
<h2><span id="取消事务discurd">取消事务(discurd)</span></h2><pre class=" language-bash"><code class="language-bash">127.0.0.1:6379<span class="token operator">></span> multi<span class="token comment" spellcheck="true"># 开启事务</span>
OK
127.0.0.1:6379<span class="token operator">></span> <span class="token keyword">set</span> k1 v1
QUEUED
127.0.0.1:6379<span class="token operator">></span> <span class="token keyword">set</span> k2 v2
QUEUED
127.0.0.1:6379<span class="token operator">></span> <span class="token keyword">set</span> k4 v4
QUEUED
127.0.0.1:6379<span class="token operator">></span> discard<span class="token comment" spellcheck="true"># 放弃事务</span>
OK
127.0.0.1:6379<span class="token operator">></span> get key4 <span class="token comment" spellcheck="true"># 被放弃事务中命令并未执行</span>
<span class="token punctuation">(</span>nil<span class="token punctuation">)</span>
</code></pre>
<h2><span id="事务错误">事务错误</span></h2><blockquote>
<p>编译型异常：代码语法错误（编译时异常）所有的命令都不执行</p>
</blockquote>
<pre class=" language-bash"><code class="language-bash">127.0.0.1:6379<span class="token operator">></span> multi
OK
127.0.0.1:6379<span class="token operator">></span> <span class="token keyword">set</span> k1 v1
QUEUED
127.0.0.1:6379<span class="token operator">></span> <span class="token keyword">set</span> k2 v2
QUEUED
127.0.0.1:6379<span class="token operator">></span> <span class="token keyword">set</span> k3 v3
QUEUED
127.0.0.1:6379<span class="token operator">></span> getset k3
<span class="token punctuation">(</span>error<span class="token punctuation">)</span> ERR wrong number of arguments <span class="token keyword">for</span> <span class="token string">'getset'</span> <span class="token function">command</span><span class="token comment" spellcheck="true">#错误的命令</span>
127.0.0.1:6379<span class="token operator">></span> <span class="token keyword">set</span> k4 v4
QUEUED
127.0.0.1:6379<span class="token operator">></span> <span class="token function">exec</span>
<span class="token punctuation">(</span>error<span class="token punctuation">)</span> EXECABORT Transaction discarded because of previous errors.<span class="token comment" spellcheck="true">#执行也报错了</span>
127.0.0.1:6379<span class="token operator">></span> get k4<span class="token comment" spellcheck="true">#所有的命令都没有执行</span>
<span class="token punctuation">(</span>nil<span class="token punctuation">)</span>
</code></pre>
<blockquote>
<p>运行时异常(1/0)：代码逻辑错误 (运行时异常) **其他命令可以正常执行 ** &gt;&gt;&gt; 所以不保证事务原子性</p>
</blockquote>
<pre class=" language-bash"><code class="language-bash">127.0.0.1:6379<span class="token operator">></span> <span class="token keyword">set</span> k1 v1
OK
127.0.0.1:6379<span class="token operator">></span> multi
OK
127.0.0.1:6379<span class="token operator">></span> incr k1
QUEUED
127.0.0.1:6379<span class="token operator">></span> <span class="token keyword">set</span> k2 v2
QUEUED
127.0.0.1:6379<span class="token operator">></span> <span class="token keyword">set</span> k3 v3
QUEUED
127.0.0.1:6379<span class="token operator">></span> <span class="token function">exec</span>
1<span class="token punctuation">)</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> ERR value is not an integer or out of range<span class="token comment" spellcheck="true">#执行失败</span>
2<span class="token punctuation">)</span> OK<span class="token comment" spellcheck="true">#执行成功</span>
3<span class="token punctuation">)</span> OK<span class="token comment" spellcheck="true">#执行成功</span>
127.0.0.1:6379<span class="token operator">></span> get k2<span class="token comment" spellcheck="true">#虽然第一条命令报错但其他的执行成功了</span>
<span class="token string">"v2"</span>
127.0.0.1:6379<span class="token operator">></span> get k3<span class="token comment" spellcheck="true">#所以说Redis单条指令保证原子性，但是Redis事务不能保证原子性。</span>
<span class="token string">"v3"</span>
</code></pre>
<h2><span id="监控watch">监控watch</span></h2><p>悲观锁：</p>
<ul>
<li>很悲观，认为什么时候都会出现问题，无论做什么都会加锁</li>
</ul>
<p>乐观锁：</p>
<ul>
<li>很乐观，认为什么时候都不会出现问题，所以不会上锁！更新数据的时候去判断一下，在此期间是否有人修改过这个数据</li>
<li>获取version</li>
<li>更新的时候比较version</li>
</ul>
<p>使用watch key监控指定数据，相当于乐观锁加锁。</p>
<blockquote>
<p>正常执行</p>
</blockquote>
<pre class=" language-bash"><code class="language-bash">127.0.0.1:6379<span class="token operator">></span> <span class="token keyword">set</span> money 100 <span class="token comment" spellcheck="true"># 设置余额:100</span>
OK
127.0.0.1:6379<span class="token operator">></span> <span class="token keyword">set</span> out 0<span class="token comment" spellcheck="true"># 支出使用:0</span>
OK
127.0.0.1:6379<span class="token operator">></span> <span class="token function">watch</span> money <span class="token comment" spellcheck="true">#监视money (上锁)</span>
OK
127.0.0.1:6379<span class="token operator">></span> multi
OK
127.0.0.1:6379<span class="token operator">></span> decrby money 20
QUEUED
127.0.0.1:6379<span class="token operator">></span> incrby out 20
QUEUED
127.0.0.1:6379<span class="token operator">></span> <span class="token function">exec</span><span class="token comment" spellcheck="true">#监视值没有被中途修改，事务正常结束</span>
1<span class="token punctuation">)</span> <span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 80
2<span class="token punctuation">)</span> <span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 20
</code></pre>
<p>测试多线程修改值，使用watch可以当做redis的乐观锁操作（相当于getversion）</p>
<p>我们启动另外一个客户端模拟插队线程。</p>
<blockquote>
<p>不正常</p>
</blockquote>
<p>线程1</p>
<pre class=" language-bash"><code class="language-bash">127.0.0.1:6379<span class="token operator">></span> <span class="token function">watch</span> money<span class="token comment" spellcheck="true">#监控money</span>
OK
127.0.0.1:6379<span class="token operator">></span> multi
OK
127.0.0.1:6379<span class="token operator">></span> decrby money 10
QUEUED
127.0.0.1:6379<span class="token operator">></span> incrby out 10<span class="token comment" spellcheck="true">#没有执行</span>
QUEUED
</code></pre>
<p>线程2</p>
<pre class=" language-bash"><code class="language-bash">127.0.0.1:6379<span class="token operator">></span> get money
<span class="token string">"80"</span>
127.0.0.1:6379<span class="token operator">></span> <span class="token keyword">set</span> money 1000<span class="token comment" spellcheck="true">#修改了线程一中监视的money</span>
OK
</code></pre>
<p>回到线程1，执行事务：</p>
<pre class=" language-bash"><code class="language-bash">127.0.0.1:6379<span class="token operator">></span> <span class="token function">exec</span><span class="token comment" spellcheck="true">#执行失败</span>
<span class="token punctuation">(</span>nil<span class="token punctuation">)</span>
</code></pre>
<p>解锁获取最新值，然后再加锁进行事务。</p>
<p>unwatch进行解锁。</p>
<p>注意：每次提交执行exec后都会自动释放锁，不管是否成功</p>
<h1><span id="jedis">Jedis</span></h1><blockquote>
<p>什么是Jedis？</p>
<p>是 官方推荐的java连接开发工具，使用java操作redis的中间件</p>
</blockquote>
<p>1.导入依赖</p>
<pre class=" language-XML"><code class="language-XML"><dependencies>
    <!--导入jredis的包-->
    <dependency>
        <groupid>redis.clients</groupid>
        <artifactid>jedis</artifactid>
        <version>3.2.0</version>
    </dependency>
    <!--fastjson-->
    <dependency>
        <groupid>com.alibaba</groupid>
        <artifactid>fastjson</artifactid>
        <version>1.2.70</version>
    </dependency>
</dependencies>
</code></pre>
<p>2.编码测试</p>
<blockquote>
<p>连接数据库<br>操作命令<br>断开连接</p>
</blockquote>
<p>代码示例</p>
<pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>lpc<span class="token punctuation">;</span>

<span class="token keyword">import</span> redis<span class="token punctuation">.</span>clients<span class="token punctuation">.</span>jedis<span class="token punctuation">.</span>Jedis<span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">/**
 * @author: lpc
 * @date: 2/12/2021 下午 10:39
 * @describe:
 * @vision
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestPing</span> <span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// 1 new Jedis对象</span>
    Jedis jedis <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Jedis</span><span class="token punctuation">(</span><span class="token string">"192.168.67.217"</span><span class="token punctuation">,</span> <span class="token number">6379</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">// jedis 所有的命令就是我们学习的所有指令</span>
    System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>jedis<span class="token punctuation">.</span><span class="token function">ping</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p><img src="/2022/01/15/redis/image-20211202230132106.png" alt="image-20211202230132106"></p>
<h2><span id="常用的api">常用的API</span></h2><p>string、list、set、hash、zset</p>
<p>所有的api命令，就是我们对应的上面学习的指令，一个都没有变化！</p>
<blockquote>
<p>key</p>
</blockquote>
<pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>lpc<span class="token punctuation">;</span>

<span class="token keyword">import</span> redis<span class="token punctuation">.</span>clients<span class="token punctuation">.</span>jedis<span class="token punctuation">.</span>Jedis<span class="token punctuation">;</span>

<span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>Set<span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">/**
 *@author: lpc
 *@date: 2/12/2021 下午 11:09
 *@describe:
 *@vision
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestKey</span> <span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      Jedis jedis <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Jedis</span><span class="token punctuation">(</span><span class="token string">"192.168.67.217"</span><span class="token punctuation">,</span> <span class="token number">6379</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"清空数据库："</span><span class="token operator">+</span>jedis<span class="token punctuation">.</span><span class="token function">flushDB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"判断某个键是否存在："</span><span class="token operator">+</span>jedis<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token string">"k1"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"新增&lt;'k1','v1'>键值对："</span><span class="token operator">+</span>jedis<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">"k1"</span><span class="token punctuation">,</span><span class="token string">"v1"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"新增&lt;'k2','v2'>键值对："</span><span class="token operator">+</span>jedis<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">"k2"</span><span class="token punctuation">,</span><span class="token string">"v2"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"系统中所有的键如下："</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      Set<span class="token operator">&lt;</span>String<span class="token operator">></span> keys <span class="token operator">=</span> jedis<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token string">"*"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>keys<span class="token punctuation">)</span><span class="token punctuation">;</span>
      System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"删除键k2："</span><span class="token operator">+</span>jedis<span class="token punctuation">.</span><span class="token function">del</span><span class="token punctuation">(</span><span class="token string">"k2"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"判断键k2是否存在："</span><span class="token operator">+</span>jedis<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token string">"k2"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"查看键 k1 所存储的数据类型："</span><span class="token operator">+</span>jedis<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token string">"k1"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"随机返回 key 空间的一个："</span><span class="token operator">+</span>jedis<span class="token punctuation">.</span><span class="token function">randomKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"重命名 key ："</span><span class="token operator">+</span>jedis<span class="token punctuation">.</span><span class="token function">rename</span><span class="token punctuation">(</span><span class="token string">"k1"</span><span class="token punctuation">,</span><span class="token string">"newk1"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"取出改后的 newk1 ："</span><span class="token operator">+</span>jedis<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"newk1"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"按索引查询："</span><span class="token operator">+</span>jedis<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"删除当前选择数据库中的所有键："</span><span class="token operator">+</span>jedis<span class="token punctuation">.</span><span class="token function">flushDB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"返回当前数据库中 key 的数量："</span><span class="token operator">+</span>jedis<span class="token punctuation">.</span><span class="token function">dbSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"删除所有数据库中的所有 key ："</span><span class="token operator">+</span>jedis<span class="token punctuation">.</span><span class="token function">flushAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<blockquote>
<p>string</p>
</blockquote>
<pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>lpc<span class="token punctuation">;</span>

<span class="token keyword">import</span> redis<span class="token punctuation">.</span>clients<span class="token punctuation">.</span>jedis<span class="token punctuation">.</span>Jedis<span class="token punctuation">;</span>

<span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span>TimeUnit<span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestString</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        Jedis jedis <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Jedis</span><span class="token punctuation">(</span><span class="token string">"192.168.67.217"</span><span class="token punctuation">,</span> <span class="token number">6379</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        jedis<span class="token punctuation">.</span><span class="token function">flushDB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"===========增加数据==========="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>jedis<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">"key1"</span><span class="token punctuation">,</span><span class="token string">"value1"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>jedis<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">"key2"</span><span class="token punctuation">,</span><span class="token string">"value2"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>jedis<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">"key3"</span><span class="token punctuation">,</span> <span class="token string">"value3"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"删除键key2:"</span><span class="token operator">+</span>jedis<span class="token punctuation">.</span><span class="token function">del</span><span class="token punctuation">(</span><span class="token string">"key2"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"获取键key2:"</span><span class="token operator">+</span>jedis<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"key2"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"修改key1:"</span><span class="token operator">+</span>jedis<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">"key1"</span><span class="token punctuation">,</span> <span class="token string">"value1Changed"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"获取key1的值："</span><span class="token operator">+</span>jedis<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"key1"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"在key3后面加入值："</span><span class="token operator">+</span>jedis<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"key3"</span><span class="token punctuation">,</span> <span class="token string">"End"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"key3的值："</span><span class="token operator">+</span>jedis<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"key3"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"增加多个键值对："</span><span class="token operator">+</span>jedis<span class="token punctuation">.</span><span class="token function">mset</span><span class="token punctuation">(</span><span class="token string">"key01"</span><span class="token punctuation">,</span><span class="token string">"value01"</span><span class="token punctuation">,</span><span class="token string">"key02"</span><span class="token punctuation">,</span><span class="token string">"value02"</span><span class="token punctuation">,</span><span class="token string">"key03"</span><span class="token punctuation">,</span><span class="token string">"value03"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"获取多个键值对："</span><span class="token operator">+</span>jedis<span class="token punctuation">.</span><span class="token function">mget</span><span class="token punctuation">(</span><span class="token string">"key01"</span><span class="token punctuation">,</span><span class="token string">"key02"</span><span class="token punctuation">,</span><span class="token string">"key03"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"获取多个键值对："</span><span class="token operator">+</span>jedis<span class="token punctuation">.</span><span class="token function">mget</span><span class="token punctuation">(</span><span class="token string">"key01"</span><span class="token punctuation">,</span><span class="token string">"key02"</span><span class="token punctuation">,</span><span class="token string">"key03"</span><span class="token punctuation">,</span><span class="token string">"key04"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"删除多个键值对："</span><span class="token operator">+</span>jedis<span class="token punctuation">.</span><span class="token function">del</span><span class="token punctuation">(</span><span class="token string">"key01"</span><span class="token punctuation">,</span><span class="token string">"key02"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"获取多个键值对："</span><span class="token operator">+</span>jedis<span class="token punctuation">.</span><span class="token function">mget</span><span class="token punctuation">(</span><span class="token string">"key01"</span><span class="token punctuation">,</span><span class="token string">"key02"</span><span class="token punctuation">,</span><span class="token string">"key03"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        jedis<span class="token punctuation">.</span><span class="token function">flushDB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"===========新增键值对防止覆盖原先值=============="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>jedis<span class="token punctuation">.</span><span class="token function">setnx</span><span class="token punctuation">(</span><span class="token string">"key1"</span><span class="token punctuation">,</span> <span class="token string">"value1"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>jedis<span class="token punctuation">.</span><span class="token function">setnx</span><span class="token punctuation">(</span><span class="token string">"key2"</span><span class="token punctuation">,</span> <span class="token string">"value2"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>jedis<span class="token punctuation">.</span><span class="token function">setnx</span><span class="token punctuation">(</span><span class="token string">"key2"</span><span class="token punctuation">,</span> <span class="token string">"value2-new"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>jedis<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"key1"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>jedis<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"key2"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"===========新增键值对并设置有效时间============="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>jedis<span class="token punctuation">.</span><span class="token function">setex</span><span class="token punctuation">(</span><span class="token string">"key3"</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">"value3"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>jedis<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"key3"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            TimeUnit<span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>jedis<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"key3"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"===========获取原值，更新为新值=========="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>jedis<span class="token punctuation">.</span><span class="token function">getSet</span><span class="token punctuation">(</span><span class="token string">"key2"</span><span class="token punctuation">,</span> <span class="token string">"key2GetSet"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>jedis<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"key2"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"获得key2的值的字串："</span><span class="token operator">+</span>jedis<span class="token punctuation">.</span><span class="token function">getrange</span><span class="token punctuation">(</span><span class="token string">"key2"</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<blockquote>
<p>list</p>
</blockquote>
<pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>lpc<span class="token punctuation">;</span>

<span class="token keyword">import</span> redis<span class="token punctuation">.</span>clients<span class="token punctuation">.</span>jedis<span class="token punctuation">.</span>Jedis<span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestList</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        Jedis jedis <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Jedis</span><span class="token punctuation">(</span><span class="token string">"192.168.67.217"</span><span class="token punctuation">,</span> <span class="token number">6379</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        jedis<span class="token punctuation">.</span><span class="token function">flushDB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"===========添加一个list==========="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        jedis<span class="token punctuation">.</span><span class="token function">lpush</span><span class="token punctuation">(</span><span class="token string">"collections"</span><span class="token punctuation">,</span> <span class="token string">"ArrayList"</span><span class="token punctuation">,</span> <span class="token string">"Vector"</span><span class="token punctuation">,</span> <span class="token string">"Stack"</span><span class="token punctuation">,</span> <span class="token string">"HashMap"</span><span class="token punctuation">,</span> <span class="token string">"WeakHashMap"</span><span class="token punctuation">,</span> <span class="token string">"LinkedHashMap"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        jedis<span class="token punctuation">.</span><span class="token function">lpush</span><span class="token punctuation">(</span><span class="token string">"collections"</span><span class="token punctuation">,</span> <span class="token string">"HashSet"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        jedis<span class="token punctuation">.</span><span class="token function">lpush</span><span class="token punctuation">(</span><span class="token string">"collections"</span><span class="token punctuation">,</span> <span class="token string">"TreeSet"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        jedis<span class="token punctuation">.</span><span class="token function">lpush</span><span class="token punctuation">(</span><span class="token string">"collections"</span><span class="token punctuation">,</span> <span class="token string">"TreeMap"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"collections的内容："</span><span class="token operator">+</span>jedis<span class="token punctuation">.</span><span class="token function">lrange</span><span class="token punctuation">(</span><span class="token string">"collections"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//-1代表倒数第一个元素，-2代表倒数第二个元素,end为-1表示查询全部</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"collections区间0-3的元素："</span><span class="token operator">+</span>jedis<span class="token punctuation">.</span><span class="token function">lrange</span><span class="token punctuation">(</span><span class="token string">"collections"</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"==============================="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// 删除列表指定的值 ，第二个参数为删除的个数（有重复时），后add进去的值先被删，类似于出栈</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"删除指定元素个数："</span><span class="token operator">+</span>jedis<span class="token punctuation">.</span><span class="token function">lrem</span><span class="token punctuation">(</span><span class="token string">"collections"</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">"HashMap"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"collections的内容："</span><span class="token operator">+</span>jedis<span class="token punctuation">.</span><span class="token function">lrange</span><span class="token punctuation">(</span><span class="token string">"collections"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"删除下表0-3区间之外的元素："</span><span class="token operator">+</span>jedis<span class="token punctuation">.</span><span class="token function">ltrim</span><span class="token punctuation">(</span><span class="token string">"collections"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"collections的内容："</span><span class="token operator">+</span>jedis<span class="token punctuation">.</span><span class="token function">lrange</span><span class="token punctuation">(</span><span class="token string">"collections"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"collections列表出栈（左端）："</span><span class="token operator">+</span>jedis<span class="token punctuation">.</span><span class="token function">lpop</span><span class="token punctuation">(</span><span class="token string">"collections"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"collections的内容："</span><span class="token operator">+</span>jedis<span class="token punctuation">.</span><span class="token function">lrange</span><span class="token punctuation">(</span><span class="token string">"collections"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"collections添加元素，从列表右端，与lpush相对应："</span><span class="token operator">+</span>jedis<span class="token punctuation">.</span><span class="token function">rpush</span><span class="token punctuation">(</span><span class="token string">"collections"</span><span class="token punctuation">,</span> <span class="token string">"EnumMap"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"collections的内容："</span><span class="token operator">+</span>jedis<span class="token punctuation">.</span><span class="token function">lrange</span><span class="token punctuation">(</span><span class="token string">"collections"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"collections列表出栈（右端）："</span><span class="token operator">+</span>jedis<span class="token punctuation">.</span><span class="token function">rpop</span><span class="token punctuation">(</span><span class="token string">"collections"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"collections的内容："</span><span class="token operator">+</span>jedis<span class="token punctuation">.</span><span class="token function">lrange</span><span class="token punctuation">(</span><span class="token string">"collections"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"修改collections指定下标1的内容："</span><span class="token operator">+</span>jedis<span class="token punctuation">.</span><span class="token function">lset</span><span class="token punctuation">(</span><span class="token string">"collections"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"LinkedArrayList"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"collections的内容："</span><span class="token operator">+</span>jedis<span class="token punctuation">.</span><span class="token function">lrange</span><span class="token punctuation">(</span><span class="token string">"collections"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"==============================="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"collections的长度："</span><span class="token operator">+</span>jedis<span class="token punctuation">.</span><span class="token function">llen</span><span class="token punctuation">(</span><span class="token string">"collections"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"获取collections下标为2的元素："</span><span class="token operator">+</span>jedis<span class="token punctuation">.</span><span class="token function">lindex</span><span class="token punctuation">(</span><span class="token string">"collections"</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"==============================="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        jedis<span class="token punctuation">.</span><span class="token function">lpush</span><span class="token punctuation">(</span><span class="token string">"sortedList"</span><span class="token punctuation">,</span> <span class="token string">"3"</span><span class="token punctuation">,</span><span class="token string">"6"</span><span class="token punctuation">,</span><span class="token string">"2"</span><span class="token punctuation">,</span><span class="token string">"0"</span><span class="token punctuation">,</span><span class="token string">"7"</span><span class="token punctuation">,</span><span class="token string">"4"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"sortedList排序前："</span><span class="token operator">+</span>jedis<span class="token punctuation">.</span><span class="token function">lrange</span><span class="token punctuation">(</span><span class="token string">"sortedList"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>jedis<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token string">"sortedList"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"sortedList排序后："</span><span class="token operator">+</span>jedis<span class="token punctuation">.</span><span class="token function">lrange</span><span class="token punctuation">(</span><span class="token string">"sortedList"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<blockquote>
<p>set</p>
</blockquote>
<pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>lpc<span class="token punctuation">;</span>

<span class="token keyword">import</span> redis<span class="token punctuation">.</span>clients<span class="token punctuation">.</span>jedis<span class="token punctuation">.</span>Jedis<span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">//基本类型之Set</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestSet</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        Jedis jedis <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Jedis</span><span class="token punctuation">(</span><span class="token string">"192.168.67.217"</span><span class="token punctuation">,</span> <span class="token number">6379</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        jedis<span class="token punctuation">.</span><span class="token function">flushDB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"============向集合中添加元素（不重复）============"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>jedis<span class="token punctuation">.</span><span class="token function">sadd</span><span class="token punctuation">(</span><span class="token string">"eleSet"</span><span class="token punctuation">,</span> <span class="token string">"e1"</span><span class="token punctuation">,</span><span class="token string">"e2"</span><span class="token punctuation">,</span><span class="token string">"e4"</span><span class="token punctuation">,</span><span class="token string">"e3"</span><span class="token punctuation">,</span><span class="token string">"e0"</span><span class="token punctuation">,</span><span class="token string">"e8"</span><span class="token punctuation">,</span><span class="token string">"e7"</span><span class="token punctuation">,</span><span class="token string">"e5"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>jedis<span class="token punctuation">.</span><span class="token function">sadd</span><span class="token punctuation">(</span><span class="token string">"eleSet"</span><span class="token punctuation">,</span> <span class="token string">"e6"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>jedis<span class="token punctuation">.</span><span class="token function">sadd</span><span class="token punctuation">(</span><span class="token string">"eleSet"</span><span class="token punctuation">,</span> <span class="token string">"e6"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"eleSet的所有元素为："</span><span class="token operator">+</span>jedis<span class="token punctuation">.</span><span class="token function">smembers</span><span class="token punctuation">(</span><span class="token string">"eleSet"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"删除一个元素e0："</span><span class="token operator">+</span>jedis<span class="token punctuation">.</span><span class="token function">srem</span><span class="token punctuation">(</span><span class="token string">"eleSet"</span><span class="token punctuation">,</span> <span class="token string">"e0"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"eleSet的所有元素为："</span><span class="token operator">+</span>jedis<span class="token punctuation">.</span><span class="token function">smembers</span><span class="token punctuation">(</span><span class="token string">"eleSet"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"删除两个元素e7和e6："</span><span class="token operator">+</span>jedis<span class="token punctuation">.</span><span class="token function">srem</span><span class="token punctuation">(</span><span class="token string">"eleSet"</span><span class="token punctuation">,</span> <span class="token string">"e7"</span><span class="token punctuation">,</span><span class="token string">"e6"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"eleSet的所有元素为："</span><span class="token operator">+</span>jedis<span class="token punctuation">.</span><span class="token function">smembers</span><span class="token punctuation">(</span><span class="token string">"eleSet"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"随机的移除集合中的一个元素："</span><span class="token operator">+</span>jedis<span class="token punctuation">.</span><span class="token function">spop</span><span class="token punctuation">(</span><span class="token string">"eleSet"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"随机的移除集合中的一个元素："</span><span class="token operator">+</span>jedis<span class="token punctuation">.</span><span class="token function">spop</span><span class="token punctuation">(</span><span class="token string">"eleSet"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"eleSet的所有元素为："</span><span class="token operator">+</span>jedis<span class="token punctuation">.</span><span class="token function">smembers</span><span class="token punctuation">(</span><span class="token string">"eleSet"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"eleSet中包含元素的个数："</span><span class="token operator">+</span>jedis<span class="token punctuation">.</span><span class="token function">scard</span><span class="token punctuation">(</span><span class="token string">"eleSet"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"e3是否在eleSet中："</span><span class="token operator">+</span>jedis<span class="token punctuation">.</span><span class="token function">sismember</span><span class="token punctuation">(</span><span class="token string">"eleSet"</span><span class="token punctuation">,</span> <span class="token string">"e3"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"e1是否在eleSet中："</span><span class="token operator">+</span>jedis<span class="token punctuation">.</span><span class="token function">sismember</span><span class="token punctuation">(</span><span class="token string">"eleSet"</span><span class="token punctuation">,</span> <span class="token string">"e1"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"e1是否在eleSet中："</span><span class="token operator">+</span>jedis<span class="token punctuation">.</span><span class="token function">sismember</span><span class="token punctuation">(</span><span class="token string">"eleSet"</span><span class="token punctuation">,</span> <span class="token string">"e5"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"================================="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>jedis<span class="token punctuation">.</span><span class="token function">sadd</span><span class="token punctuation">(</span><span class="token string">"eleSet1"</span><span class="token punctuation">,</span> <span class="token string">"e1"</span><span class="token punctuation">,</span><span class="token string">"e2"</span><span class="token punctuation">,</span><span class="token string">"e4"</span><span class="token punctuation">,</span><span class="token string">"e3"</span><span class="token punctuation">,</span><span class="token string">"e0"</span><span class="token punctuation">,</span><span class="token string">"e8"</span><span class="token punctuation">,</span><span class="token string">"e7"</span><span class="token punctuation">,</span><span class="token string">"e5"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>jedis<span class="token punctuation">.</span><span class="token function">sadd</span><span class="token punctuation">(</span><span class="token string">"eleSet2"</span><span class="token punctuation">,</span> <span class="token string">"e1"</span><span class="token punctuation">,</span><span class="token string">"e2"</span><span class="token punctuation">,</span><span class="token string">"e4"</span><span class="token punctuation">,</span><span class="token string">"e3"</span><span class="token punctuation">,</span><span class="token string">"e0"</span><span class="token punctuation">,</span><span class="token string">"e8"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"将eleSet1中删除e1并存入eleSet3中："</span><span class="token operator">+</span>jedis<span class="token punctuation">.</span><span class="token function">smove</span><span class="token punctuation">(</span><span class="token string">"eleSet1"</span><span class="token punctuation">,</span> <span class="token string">"eleSet3"</span><span class="token punctuation">,</span> <span class="token string">"e1"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//移到集合元素</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"将eleSet1中删除e2并存入eleSet3中："</span><span class="token operator">+</span>jedis<span class="token punctuation">.</span><span class="token function">smove</span><span class="token punctuation">(</span><span class="token string">"eleSet1"</span><span class="token punctuation">,</span> <span class="token string">"eleSet3"</span><span class="token punctuation">,</span> <span class="token string">"e2"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"eleSet1中的元素："</span><span class="token operator">+</span>jedis<span class="token punctuation">.</span><span class="token function">smembers</span><span class="token punctuation">(</span><span class="token string">"eleSet1"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"eleSet3中的元素："</span><span class="token operator">+</span>jedis<span class="token punctuation">.</span><span class="token function">smembers</span><span class="token punctuation">(</span><span class="token string">"eleSet3"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"============集合运算================="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"eleSet1中的元素："</span><span class="token operator">+</span>jedis<span class="token punctuation">.</span><span class="token function">smembers</span><span class="token punctuation">(</span><span class="token string">"eleSet1"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"eleSet2中的元素："</span><span class="token operator">+</span>jedis<span class="token punctuation">.</span><span class="token function">smembers</span><span class="token punctuation">(</span><span class="token string">"eleSet2"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"eleSet1和eleSet2的交集:"</span><span class="token operator">+</span>jedis<span class="token punctuation">.</span><span class="token function">sinter</span><span class="token punctuation">(</span><span class="token string">"eleSet1"</span><span class="token punctuation">,</span><span class="token string">"eleSet2"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"eleSet1和eleSet2的并集:"</span><span class="token operator">+</span>jedis<span class="token punctuation">.</span><span class="token function">sunion</span><span class="token punctuation">(</span><span class="token string">"eleSet1"</span><span class="token punctuation">,</span><span class="token string">"eleSet2"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"eleSet1和eleSet2的差集:"</span><span class="token operator">+</span>jedis<span class="token punctuation">.</span><span class="token function">sdiff</span><span class="token punctuation">(</span><span class="token string">"eleSet1"</span><span class="token punctuation">,</span><span class="token string">"eleSet2"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//eleSet1中有，eleSet2中没有</span>
        jedis<span class="token punctuation">.</span><span class="token function">sinterstore</span><span class="token punctuation">(</span><span class="token string">"eleSet4"</span><span class="token punctuation">,</span><span class="token string">"eleSet1"</span><span class="token punctuation">,</span><span class="token string">"eleSet2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//求交集并将交集保存到dstkey的集合</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"eleSet4中的元素："</span><span class="token operator">+</span>jedis<span class="token punctuation">.</span><span class="token function">smembers</span><span class="token punctuation">(</span><span class="token string">"eleSet4"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<blockquote>
<p>hash</p>
</blockquote>
<pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>lpc<span class="token punctuation">;</span>

<span class="token keyword">import</span> redis<span class="token punctuation">.</span>clients<span class="token punctuation">.</span>jedis<span class="token punctuation">.</span>Jedis<span class="token punctuation">;</span>

<span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>HashMap<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>Map<span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">//基本类型之Hash</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestHash</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        Jedis jedis <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Jedis</span><span class="token punctuation">(</span><span class="token string">"192.168.67.217"</span><span class="token punctuation">,</span> <span class="token number">6379</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        jedis<span class="token punctuation">.</span><span class="token function">flushDB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span>String<span class="token operator">></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token operator">&lt;</span>String<span class="token punctuation">,</span>String<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"key1"</span><span class="token punctuation">,</span><span class="token string">"value1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"key2"</span><span class="token punctuation">,</span><span class="token string">"value2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"key3"</span><span class="token punctuation">,</span><span class="token string">"value3"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"key4"</span><span class="token punctuation">,</span><span class="token string">"value4"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">//添加名称为hash（key）的hash元素</span>
        jedis<span class="token punctuation">.</span><span class="token function">hmset</span><span class="token punctuation">(</span><span class="token string">"hash"</span><span class="token punctuation">,</span>map<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">//向名称为hash的hash中添加key为key5，value为value5元素</span>
        jedis<span class="token punctuation">.</span><span class="token function">hset</span><span class="token punctuation">(</span><span class="token string">"hash"</span><span class="token punctuation">,</span> <span class="token string">"key5"</span><span class="token punctuation">,</span> <span class="token string">"value5"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"散列hash的所有键值对为："</span><span class="token operator">+</span>jedis<span class="token punctuation">.</span><span class="token function">hgetAll</span><span class="token punctuation">(</span><span class="token string">"hash"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//return Map&lt;String,String></span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"散列hash的所有键为："</span><span class="token operator">+</span>jedis<span class="token punctuation">.</span><span class="token function">hkeys</span><span class="token punctuation">(</span><span class="token string">"hash"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//return Set&lt;String></span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"散列hash的所有值为："</span><span class="token operator">+</span>jedis<span class="token punctuation">.</span><span class="token function">hvals</span><span class="token punctuation">(</span><span class="token string">"hash"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//return List&lt;String></span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"将key6保存的值加上一个整数，如果key6不存在则添加key6："</span><span class="token operator">+</span>jedis<span class="token punctuation">.</span><span class="token function">hincrBy</span><span class="token punctuation">(</span><span class="token string">"hash"</span><span class="token punctuation">,</span> <span class="token string">"key6"</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"散列hash的所有键值对为："</span><span class="token operator">+</span>jedis<span class="token punctuation">.</span><span class="token function">hgetAll</span><span class="token punctuation">(</span><span class="token string">"hash"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"将key6保存的值加上一个整数，如果key6不存在则添加key6："</span><span class="token operator">+</span>jedis<span class="token punctuation">.</span><span class="token function">hincrBy</span><span class="token punctuation">(</span><span class="token string">"hash"</span><span class="token punctuation">,</span> <span class="token string">"key6"</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"散列hash的所有键值对为："</span><span class="token operator">+</span>jedis<span class="token punctuation">.</span><span class="token function">hgetAll</span><span class="token punctuation">(</span><span class="token string">"hash"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"删除一个或者多个键值对："</span><span class="token operator">+</span>jedis<span class="token punctuation">.</span><span class="token function">hdel</span><span class="token punctuation">(</span><span class="token string">"hash"</span><span class="token punctuation">,</span> <span class="token string">"key2"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"散列hash的所有键值对为："</span><span class="token operator">+</span>jedis<span class="token punctuation">.</span><span class="token function">hgetAll</span><span class="token punctuation">(</span><span class="token string">"hash"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"散列hash中键值对的个数："</span><span class="token operator">+</span>jedis<span class="token punctuation">.</span><span class="token function">hlen</span><span class="token punctuation">(</span><span class="token string">"hash"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"判断hash中是否存在key2："</span><span class="token operator">+</span>jedis<span class="token punctuation">.</span><span class="token function">hexists</span><span class="token punctuation">(</span><span class="token string">"hash"</span><span class="token punctuation">,</span><span class="token string">"key2"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"判断hash中是否存在key3："</span><span class="token operator">+</span>jedis<span class="token punctuation">.</span><span class="token function">hexists</span><span class="token punctuation">(</span><span class="token string">"hash"</span><span class="token punctuation">,</span><span class="token string">"key3"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"获取hash中的值："</span><span class="token operator">+</span>jedis<span class="token punctuation">.</span><span class="token function">hmget</span><span class="token punctuation">(</span><span class="token string">"hash"</span><span class="token punctuation">,</span><span class="token string">"key3"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"获取hash中的值："</span><span class="token operator">+</span>jedis<span class="token punctuation">.</span><span class="token function">hmget</span><span class="token punctuation">(</span><span class="token string">"hash"</span><span class="token punctuation">,</span><span class="token string">"key3"</span><span class="token punctuation">,</span><span class="token string">"key4"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<blockquote>
<p>事务</p>
</blockquote>
<pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>lpc<span class="token punctuation">;</span>

<span class="token keyword">import</span> com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>fastjson<span class="token punctuation">.</span>JSONObject<span class="token punctuation">;</span>
<span class="token keyword">import</span> redis<span class="token punctuation">.</span>clients<span class="token punctuation">.</span>jedis<span class="token punctuation">.</span>Jedis<span class="token punctuation">;</span>
<span class="token keyword">import</span> redis<span class="token punctuation">.</span>clients<span class="token punctuation">.</span>jedis<span class="token punctuation">.</span>Transaction<span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">/**
 * @author: lpc
 * @date: 3/12/2021 上午 9:05
 * @describe:
 * @vision
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestTX</span> <span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">//</span>
    Jedis jedis <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Jedis</span><span class="token punctuation">(</span><span class="token string">"192.168.67.217"</span><span class="token punctuation">,</span> <span class="token number">6379</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    jedis<span class="token punctuation">.</span><span class="token function">flushDB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    JSONObject jsonObject <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JSONObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    jsonObject<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">,</span> <span class="token string">"world"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    jsonObject<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">,</span> <span class="token string">"lpc"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">//      开启事务</span>
    Transaction multi <span class="token operator">=</span> jedis<span class="token punctuation">.</span><span class="token function">multi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    String result <span class="token operator">=</span> jsonObject<span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      multi<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">"user1"</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
      multi<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">"user2"</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">1</span><span class="token operator">/</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//制造异常</span>
      multi<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//执行事务</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      multi<span class="token punctuation">.</span><span class="token function">discard</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//放弃事务</span>
      e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
      System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>jedis<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"user1"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>jedis<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"user2"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      jedis<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//      关闭链接</span>
    <span class="token punctuation">}</span>

  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h1><span id="springboot整合">SpringBoot整合</span></h1><p>SpringBoot 操作数据：spring-data jpa jdbc mongodb redis！</p>
<p>SpringData 也是和 SpringBoot 齐名的项目！</p>
<p>说明： 在 SpringBoot2.x 之后，原来使用的jedis 被替换为了 lettuce?</p>
<p><img src="/2022/01/15/redis/image-20211203095113115.png" alt="image-20211203095113115"></p>
<p>jedis : 采用的直连，多个线程操作的话，是不安全的，如果想要避免不安全的，使用 jedis pool 连接池！ 更像 BIO 模式</p>
<p>lettuce : 采用netty，实例可以再多个线程中进行共享，不存在线程不安全的情况！可以减少线程数据了，更像 NIO 模式</p>
<p>源码分析：</p>
<pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@ConditionalOnSingleCandidate</span><span class="token punctuation">(</span>RedisConnectionFactory<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">// 我们可以自己定义一个redisTemplate来替换这个默认的！</span>
<span class="token keyword">public</span> RedisTemplate<span class="token operator">&lt;</span>Object<span class="token punctuation">,</span> Object<span class="token operator">></span> <span class="token function">redisTemplate</span><span class="token punctuation">(</span>RedisConnectionFactory redisConnectionFactory<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token comment" spellcheck="true">// 默认的 RedisTemplate 没有过多的设置，redis 对象都是需要序列化！</span>
   <span class="token comment" spellcheck="true">// 两个泛型都是 Object, Object 的类型，我们后使用需要强制转换 &lt;String, Object></span>
    RedisTemplate<span class="token operator">&lt;</span>Object<span class="token punctuation">,</span> Object<span class="token operator">></span> template <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RedisTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    template<span class="token punctuation">.</span><span class="token function">setConnectionFactory</span><span class="token punctuation">(</span>redisConnectionFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> template<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Bean</span>
<span class="token annotation punctuation">@ConditionalOnMissingBean</span>
<span class="token annotation punctuation">@ConditionalOnSingleCandidate</span><span class="token punctuation">(</span>RedisConnectionFactory<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">// 由于 String 是redis中最常使用的类型，所以说单独提出来了一个bean！</span>
<span class="token keyword">public</span> StringRedisTemplate <span class="token function">stringRedisTemplate</span><span class="token punctuation">(</span>RedisConnectionFactory redisConnectionFactory<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">StringRedisTemplate</span><span class="token punctuation">(</span>redisConnectionFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>我们在学习SpringBoot自动配置的原理时，整合一个组件并进行配置一定会有一个自动配置类xxxAutoConfiguration,并且在spring.factories中也一定能找到这个类的完全限定名。Redis也不例外。</p>
<h2><span id="整合测试">整合测试</span></h2><p>1.导入依赖</p>
<pre class=" language-xml"><code class="language-xml"><span class="token comment" spellcheck="true">&lt;!--操作redis--></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-starter-data-redis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>
</code></pre>
<p>2.编写配置文件</p>
<pre class=" language-properties"><code class="language-properties"><span class="token comment" spellcheck="true">#redis的配置</span>
<span class="token attr-name">spring.redis.host</span><span class="token punctuation">=</span><span class="token attr-value">192.168.67.217</span>
<span class="token attr-name">spring.redis.port</span><span class="token punctuation">=</span><span class="token attr-value">6379</span>
</code></pre>
<p>3.使用RedisTemplate</p>
<pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>lpc<span class="token punctuation">;</span>

<span class="token keyword">import</span> org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span>Test<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>Autowired<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>test<span class="token punctuation">.</span>context<span class="token punctuation">.</span>SpringBootTest<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>core<span class="token punctuation">.</span>RedisTemplate<span class="token punctuation">;</span>

<span class="token annotation punctuation">@SpringBootTest</span>
<span class="token keyword">class</span> <span class="token class-name">Redis02SpringbootApplicationTests</span> <span class="token punctuation">{</span>
  <span class="token annotation punctuation">@Autowired</span> <span class="token keyword">private</span> RedisTemplate redisTemplate<span class="token punctuation">;</span>
  <span class="token annotation punctuation">@Test</span>
  <span class="token keyword">void</span> <span class="token function">contextLoads</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">//    redisTemplate操作不同的类型，和我们redis的指令是一样的</span>
    <span class="token comment" spellcheck="true">//    opsForValue：操作string</span>
    <span class="token comment" spellcheck="true">//    opsForList： 操作list</span>
    <span class="token comment" spellcheck="true">//    opsForSet</span>
    <span class="token comment" spellcheck="true">//    opsForHash</span>
    <span class="token comment" spellcheck="true">//    opsForZSet</span>
    <span class="token comment" spellcheck="true">//    opsForHash</span>
    <span class="token comment" spellcheck="true">//    除了特殊的操作，我们常用的方法都可以通过redisTemplate操作</span>
    <span class="token comment" spellcheck="true">//    获取连接</span>
    <span class="token comment" spellcheck="true">//    redisTemplate.getConnectionFactory();</span>
     
    redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">"k1"</span><span class="token punctuation">,</span> <span class="token string">"你好"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"k1"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>4.测试结果</p>
<p><img src="/2022/01/15/redis/image-20211203103438995.png" alt="image-20211203103438995"></p>
<p>此时我们回到Redis查看数据时候，惊奇发现全是乱码，可是程序中可以正常输出。这时候就关系到存储对象的序列化问题，在网络中传输的对象也是一样需要序列化，否者就全是乱码。</p>
<p>RedisTemplate内部的序列化配置是这样的</p>
<p><img src="/2022/01/15/redis/image-20211203103744213.png" alt="image-20211203103744213"></p>
<p>默认的序列化器是采用JDK序列化器(我们能回使用json转义)</p>
<p><img src="/2022/01/15/redis/image-20211203103941685.png" alt="image-20211203103941685"></p>
<pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>lpc<span class="token punctuation">.</span>pojo<span class="token punctuation">;</span>

<span class="token keyword">import</span> lombok<span class="token punctuation">.</span>AllArgsConstructor<span class="token punctuation">;</span>
<span class="token keyword">import</span> lombok<span class="token punctuation">.</span>Data<span class="token punctuation">;</span>
<span class="token keyword">import</span> lombok<span class="token punctuation">.</span>NoArgsConstructor<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span>Component<span class="token punctuation">;</span>

<span class="token keyword">import</span> java<span class="token punctuation">.</span>io<span class="token punctuation">.</span>Serializable<span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">/**
 *@author: lpc
 *@date: 3/12/2021 上午 10:44
 *@describe:
 *@vision
 */</span>
<span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@AllArgsConstructor</span>
<span class="token annotation punctuation">@NoArgsConstructor</span>
<span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span>  <span class="token punctuation">{</span>
    <span class="token keyword">private</span> String name<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> age<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<pre class=" language-java"><code class="language-java"> <span class="token annotation punctuation">@Test</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> JsonProcessingException <span class="token punctuation">{</span>
<span class="token comment" spellcheck="true">//    真实的开发一般用json传递</span>
    User user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token string">"lpc"</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">//    String jsonUser = new ObjectMapper().writeValueAsString(user);</span>
    redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">"user"</span><span class="token punctuation">,</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
    System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"user"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre>
<p><img src="/2022/01/15/redis/image-20211203105343593.png" alt="image-20211203105343593"></p>
<p>数据必须序列化才能传输，我们可以通过jackson序列化也可以实现Serializable接口序列化</p>
<p>后续我们定制RedisTemplate就可以对其进行修改。</p>
<pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>lpc<span class="token punctuation">.</span>config<span class="token punctuation">;</span>

<span class="token keyword">import</span> com<span class="token punctuation">.</span>fasterxml<span class="token punctuation">.</span>jackson<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>JsonAutoDetect<span class="token punctuation">;</span>
<span class="token keyword">import</span> com<span class="token punctuation">.</span>fasterxml<span class="token punctuation">.</span>jackson<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>PropertyAccessor<span class="token punctuation">;</span>
<span class="token keyword">import</span> com<span class="token punctuation">.</span>fasterxml<span class="token punctuation">.</span>jackson<span class="token punctuation">.</span>databind<span class="token punctuation">.</span>ObjectMapper<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>Bean<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>Configuration<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>connection<span class="token punctuation">.</span>RedisConnectionFactory<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>core<span class="token punctuation">.</span>RedisTemplate<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>serializer<span class="token punctuation">.</span>Jackson2JsonRedisSerializer<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>serializer<span class="token punctuation">.</span>StringRedisSerializer<span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">/**
 * @author: lpc
 * @date: 3/12/2021 上午 10:41
 * @describe:
 * @vision
 */</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RedisConfig</span> <span class="token punctuation">{</span>

  <span class="token comment" spellcheck="true">//    编写我们自己都redistemplate</span>
  <span class="token annotation punctuation">@Bean</span>
  <span class="token keyword">public</span> RedisTemplate<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> Object<span class="token operator">></span> <span class="token function">redisTemplate</span><span class="token punctuation">(</span>RedisConnectionFactory factory<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// 我们为了自己开发方便，一般直接使用 &lt;String, Object></span>
    RedisTemplate<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> Object<span class="token operator">></span> template <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RedisTemplate</span><span class="token operator">&lt;</span>String<span class="token punctuation">,</span> Object<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    template<span class="token punctuation">.</span><span class="token function">setConnectionFactory</span><span class="token punctuation">(</span>factory<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">// Json序列化配置</span>
    Jackson2JsonRedisSerializer jackson2JsonRedisSerializer <span class="token operator">=</span>
        <span class="token keyword">new</span> <span class="token class-name">Jackson2JsonRedisSerializer</span><span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ObjectMapper om <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectMapper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    om<span class="token punctuation">.</span><span class="token function">setVisibility</span><span class="token punctuation">(</span>PropertyAccessor<span class="token punctuation">.</span>ALL<span class="token punctuation">,</span> JsonAutoDetect<span class="token punctuation">.</span>Visibility<span class="token punctuation">.</span>ANY<span class="token punctuation">)</span><span class="token punctuation">;</span>
    om<span class="token punctuation">.</span><span class="token function">enableDefaultTyping</span><span class="token punctuation">(</span>ObjectMapper<span class="token punctuation">.</span>DefaultTyping<span class="token punctuation">.</span>NON_FINAL<span class="token punctuation">)</span><span class="token punctuation">;</span>
    jackson2JsonRedisSerializer<span class="token punctuation">.</span><span class="token function">setObjectMapper</span><span class="token punctuation">(</span>om<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">// String 的序列化</span>
    StringRedisSerializer stringRedisSerializer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringRedisSerializer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">// key采用String的序列化方式</span>
    template<span class="token punctuation">.</span><span class="token function">setKeySerializer</span><span class="token punctuation">(</span>stringRedisSerializer<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">// hash的key也采用String的序列化方式</span>
    template<span class="token punctuation">.</span><span class="token function">setHashKeySerializer</span><span class="token punctuation">(</span>stringRedisSerializer<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">// value序列化方式采用jackson</span>
    template<span class="token punctuation">.</span><span class="token function">setValueSerializer</span><span class="token punctuation">(</span>jackson2JsonRedisSerializer<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">// hash的value序列化方式采用jackson</span>
    template<span class="token punctuation">.</span><span class="token function">setHashValueSerializer</span><span class="token punctuation">(</span>jackson2JsonRedisSerializer<span class="token punctuation">)</span><span class="token punctuation">;</span>
    template<span class="token punctuation">.</span><span class="token function">afterPropertiesSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> template<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>再次测试(User去掉Serializable)</p>
<pre class=" language-java"><code class="language-java">  <span class="token annotation punctuation">@Test</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> JsonProcessingException <span class="token punctuation">{</span>
<span class="token comment" spellcheck="true">//    真实的开发一般用json传递</span>
    User user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token string">"lpc2"</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">//    String jsonUser = new ObjectMapper().writeValueAsString(user);</span>
    redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">"user"</span><span class="token punctuation">,</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
    System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"user"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre>
<p><img src="/2022/01/15/redis/image-20211203110353250.png" alt="image-20211203110353250"></p>
<p>所有的redis操作，其实对于java开发人员来说，十分的简单，更重要是要去理解redis的思想和每一种数据结构的用处和作用场景！</p>
<h1><span id="redisconf">Redis.conf</span></h1><blockquote>
<h2><span id="单位">单位</span></h2></blockquote>
<p>容量单位不区分大小写，G和GB有区别</p>
<p><img src="/2022/01/15/redis/image-20211203111447734.png" alt="image-20211203111447734"></p>
<blockquote>
<h2><span id="包含">包含</span></h2></blockquote>
<p>可以使用 include 组合多个配置问题</p>
<p><img src="/2022/01/15/redis/image-20211203112129510.png" alt="image-20211203112129510"></p>
<blockquote>
<h2><span id="网络配置">网络配置</span></h2></blockquote>
<p><img src="/2022/01/15/redis/image-20211203112450805.png" alt="image-20211203112450805"></p>
<blockquote>
<h2><span id="通用">通用</span></h2></blockquote>
<pre class=" language-tex"><code class="language-tex">daemonize yes//默认是no 启动守护进程启动
pidfile /var/run/redis_6379.pid #如果以后台方式启动，我们就需要指定一个pid文件
</code></pre>
<p>日志</p>
<p><img src="/2022/01/15/redis/image-20211203112844433.png" alt="image-20211203112844433"></p>
<p>notice生产环境</p>
<p>logfile日志文件位置</p>
<p>默认16个数据库</p>
<p><img src="/2022/01/15/redis/image-20211203112953880.png" alt="image-20211203112953880"></p>
<p>是否显示logo</p>
<p><img src="/2022/01/15/redis/image-20211203113020843.png" alt="image-20211203113020843"></p>
<blockquote>
<h2><span id="快照">快照</span></h2></blockquote>
<p>在规定的时间内，执行了多少操作，则会持久化到.rdb.aof</p>
<p>redis是内存数据库，断电即失</p>
<p><img src="/2022/01/15/redis/image-20211203113150974.png" alt="image-20211203113150974"></p>
<pre class=" language-tex"><code class="language-tex">如果900秒内，如果至少有1个key进行了修改，我们就进行持久化
如果300秒内，如果至少有10个key进行了修改，我们就进行持久化
如果60秒内，如果至少有10000个key进行了修改，我们就进行持久化
</code></pre>
<p><img src="/2022/01/15/redis/image-20211203113401853.png" alt="image-20211203113401853"></p>
<p>如果持久化出错，是否还继续工作</p>
<p><img src="/2022/01/15/redis/image-20211203113431935.png" alt="image-20211203113431935"></p>
<p>是否压缩rdb文件</p>
<p><img src="/2022/01/15/redis/image-20211203113517559.png" alt="image-20211203113517559"></p>
<p>保存rdb文件的时候进行错误校验</p>
<p><img src="/2022/01/15/redis/image-20211203113545697.png" alt="image-20211203113545697"></p>
<p>rdb保存的目录</p>
<blockquote>
<h2><span id="replication-主从复制讲">REPLICATION 主从复制讲</span></h2></blockquote>
<blockquote>
<h2><span id="security">SECURITY</span></h2></blockquote>
<p><img src="/2022/01/15/redis/image-20211203113809537.png" alt="image-20211203113809537"></p>
<p>设置密码(默没有密码)</p>
<p><img src="/2022/01/15/redis/image-20211203113852352.png" alt="image-20211203113852352"></p>
<p>设置密码</p>
<pre class=" language-bash"><code class="language-bash">127.0.0.1:6379<span class="token operator">></span> config get requirepass<span class="token comment" spellcheck="true">#获取redis的密码</span>
1<span class="token punctuation">)</span> <span class="token string">"requirepass"</span>
2<span class="token punctuation">)</span> <span class="token string">""</span>
127.0.0.1:6379<span class="token operator">></span> config <span class="token keyword">set</span> requirepass 123456<span class="token comment" spellcheck="true">#设置密码</span>
OK
127.0.0.1:6379<span class="token operator">></span> config get requirepass<span class="token comment" spellcheck="true">#发现命令不能用了</span>
<span class="token punctuation">(</span>error<span class="token punctuation">)</span> NOAUTH Authentication required.
127.0.0.1:6379<span class="token operator">></span> <span class="token function">ping</span>
<span class="token punctuation">(</span>error<span class="token punctuation">)</span> NOAUTH Authentication required.
127.0.0.1:6379<span class="token operator">></span> auth 123456<span class="token comment" spellcheck="true">#密码登录</span>
OK
127.0.0.1:6379<span class="token operator">></span> config get requirepass
1<span class="token punctuation">)</span> <span class="token string">"requirepass"</span>
2<span class="token punctuation">)</span> <span class="token string">"123456"</span>
</code></pre>
<blockquote>
<h2><span id="限制clients">限制CLIENTS</span></h2></blockquote>
<p><img src="/2022/01/15/redis/image-20211203114233959.png" alt="image-20211203114233959"></p>
<p><img src="/2022/01/15/redis/image-20211203114307483.png" alt="image-20211203114307483"></p>
<p><img src="/2022/01/15/redis/image-20211203114406452.png" alt="image-20211203114406452"></p>
<p>maxmemory-policy noviction (内存到达上限后的处理策略)　　</p>
<pre class=" language-tex"><code class="language-tex">1、volatile-lru：只对设置了过期时间的key进行LRU（默认值）

2、allkeys-lru：删除LRU算法的key

3、volatile-random：随机删除即将过期的key

4、allkeys-random：随机删除

5、volatile-ttl：删除即将过期的

6、noeviction：永不过期，返回错误
</code></pre>
<blockquote>
<h2><span id="append-only-mode">APPEND ONLY MODE</span></h2></blockquote>
<p><img src="/2022/01/15/redis/image-20211203114710148.png" alt="image-20211203114710148"></p>
<p>默认rdb够用</p>
<p><img src="/2022/01/15/redis/image-20211203114745040.png" alt="image-20211203114745040"></p>
<p><img src="/2022/01/15/redis/image-20211203114902012.png" alt="image-20211203114902012"></p>
<pre class=" language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># appendfsync always  #每次修改都会sync 消耗性能</span>
appendfsync everysec  <span class="token comment" spellcheck="true">#每秒执行一次sync同步 可能会丢失这一秒的数据</span>
<span class="token comment" spellcheck="true"># appendfsync no      #不同步</span>
</code></pre>
<h1><span id="redis持久化rdb">Redis持久化——RDB</span></h1><p>面试和工作，持久化都是重点！<br>Redis 是内存数据库，如果不将内存中的数据库状态保存到磁盘，那么一旦服务器进程退出，服务器中的数据库状态也会消失。所以 Redis 提供了持久化功能！</p>
<h2><span id="什么是rdbredis-database">什么是RDB（Redis DataBase）</span></h2><blockquote>
<p>在指定时间间隔后，将内存中的数据集快照写入数据库 ；在恢复时候，直接读取快照文件，进行数据的恢复 ；<br>默认情况下， Redis 将数据库快照保存在名字为 dump.rdb的二进制文件中。文件名可以在配置文件中进行自定义。</p>
</blockquote>
<p>在指定的时间间隔内将内存中的数据集快照写入磁盘，也就是行话讲的Snapshot快照，它恢复时是将快照文件直接读到内存里。<br>Redis会单独创建（fork）一个子进程来进行持久化，会先将数据写入到一个临时文件中，待持久化过程都结束了，再用这个临时文件替换上次持久化好的文件。整个过程中，主进程是不进行任何IO操作的。<br>这就确保了极高的性能。如果需要进行大规模数据的恢复，且对于数据恢复的完整性不是非常敏感，那RDB方式要比AOF方式更加的高效。RDB的缺点是最后一次持久化后的数据可能丢失。我们默认的就是RDB，一般情况下不需要修改这个配置！ </p>
<p>有时候在生产环境我们会将这个文件进行备份！<br>==rdb保存的文件是dump.rdb 都是在我们的配置文件中快照中进行配置的！==</p>
<h2><span id="工作原理">工作原理</span></h2><p>在进行 RDB 的时候，redis 的主线程是不会做 io 操作的，主线程会 fork 一个子线程来完成该操作；</p>
<ol>
<li>Redis 调用forks。同时拥有父进程和子进程。</li>
<li>子进程将数据集写入到一个临时 RDB 文件中。</li>
<li>当子进程完成对新 RDB 文件的写入时，Redis 用新 RDB 文件替换原来的 RDB 文件，并删除旧的 RDB 文件。</li>
</ol>
<p>这种工作方式使得 Redis 可以从写时复制（copy-on-write）机制中获益(因为是使用子进程进行写操作，而父进程依然可以接收来自客户端的请求。)</p>
<p><img src="/2022/01/15/redis/image-20211203123322632.png" alt="image-20211203123322632"></p>
<h2><span id="触发机制">触发机制</span></h2><ol>
<li>save的规则满足的情况下，会自动触发rdb原则</li>
<li>执行flushall命令，也会触发我们的rdb原则</li>
<li>退出redis，也会自动产生rdb文件</li>
</ol>
<h3><span id="save">save</span></h3><p>使用 save 命令，会立刻对当前内存中的数据进行持久化 ,但是会阻塞，也就是不接受其他操作了；</p>
<blockquote>
<p>由于 save 命令是同步命令，会占用Redis的主进程。若Redis数据非常多时，save命令执行速度会非常慢，阻塞所有客户端的请求。</p>
</blockquote>
<p>示意图</p>
<p><img src="/2022/01/15/redis/image-20211203123416789.png" alt="image-20211203123416789"></p>
<h3><span id="flushall命令">flushall命令</span></h3><p>flushall 命令也会触发持久化 ；</p>
<p>触发持久化规则<br>满足配置条件中的触发条件 ；</p>
<blockquote>
<p>可以通过配置文件对 Redis 进行设置， 让它在“ N 秒内数据集至少有 M 个改动”这一条件被满足时， 自动进行数据集保存操作。</p>
</blockquote>
<h3><span id="bgsave">bgsave</span></h3><p>bgsave 是异步进行，进行持久化的时候，redis 还可以将继续响应客户端请求 ；</p>
<p><img src="/2022/01/15/redis/image-20211203123937796.png" alt="image-20211203123937796"></p>
<p>bgsave和save对比</p>
<table>
<thead>
<tr>
<th align="left">命令</th>
<th align="left">save</th>
<th align="left">bgsave</th>
</tr>
</thead>
<tbody><tr>
<td align="left">IO类型</td>
<td align="left">同步</td>
<td align="left">异步</td>
</tr>
<tr>
<td align="left">阻塞？</td>
<td align="left">是</td>
<td align="left">是（阻塞发生在fock()，通常非常快）</td>
</tr>
<tr>
<td align="left">复杂度</td>
<td align="left">O(n)</td>
<td align="left">O(n)</td>
</tr>
<tr>
<td align="left">优点</td>
<td align="left">不会消耗额外的内存</td>
<td align="left">不阻塞客户端命令</td>
</tr>
<tr>
<td align="left">缺点</td>
<td align="left">阻塞客户端命令</td>
<td align="left">需要fock子进程，消耗内存</td>
</tr>
</tbody></table>
<h2><span id="如果恢复rdb文件">如果恢复rdb文件！</span></h2><p>1、只需要将rdb文件放在我们redis启动目录就可以，redis启动的时候会自动检查dump.rdb 恢复其中的数据！<br>2、查看需要存在的位置</p>
<pre class=" language-bash"><code class="language-bash">127.0.0.1:6379<span class="token operator">></span> config get <span class="token function">dir</span>
1<span class="token punctuation">)</span> <span class="token string">"dir"</span>
2<span class="token punctuation">)</span> <span class="token string">"/usr/local/bin"</span> <span class="token comment" spellcheck="true"># 如果在这个目录下存在 dump.rdb 文件，启动就会自动恢复其中的数据</span>
</code></pre>
<blockquote>
<p>几乎它默认的配置就够用了，但是我们还是需要学习！</p>
</blockquote>
<h2><span id="优缺点">优缺点</span></h2><blockquote>
<p>优点：</p>
</blockquote>
<ol>
<li>适合大规模的数据恢复</li>
<li>对数据的完整性要求不高</li>
</ol>
<blockquote>
<p>缺点：</p>
</blockquote>
<ol>
<li>需要一定的时间间隔进行操作，如果redis意外宕机了，这个最后一次修改的数据就没有了。</li>
<li>fork进程的时候，会占用一定的内容空间。</li>
</ol>
<h1><span id="redis持久化aof">Redis持久化——AOF</span></h1><p>Append Only File</p>
<p>将我们所有的命令都记录下来，history，恢复的时候就把这个文件全部再执行一遍</p>
<p><img src="/2022/01/15/redis/image-20211203130013039.png" alt="image-20211203130013039"></p>
<p><strong>以日志的形式来记录每个写的操作</strong>，将Redis执行过的所有指令记录下来（读操作不记录），只许追加文件但不可以改写文件，redis启动之初会读取该文件重新构建数据，换言之，redis重启的话就根据日志文件的内容将写指令从前到后执行一次以完成数据的恢复工作。</p>
<p>==AOF保存的是appendonly.aof文件==</p>
<h2><span id="什么是aof">什么是AOF</span></h2><p> 快照功能（RDB）并不是非常耐久（durable）： 如果 Redis 因为某些原因而造成故障停机， 那么服务器将丢失最近写入、以及未保存到快照中的那些数据。 从 1.1 版本开始， Redis 增加了一种完全耐久的持久化方式： AOF 持久化。</p>
<p>appendonly no yes则表示启用AOF</p>
<p><strong>默认是不开启的，我们需要手动配置，然后重启redis，就可以生效了！</strong></p>
<pre class=" language-bash"><code class="language-bash">appendonly <span class="token function">yes</span>  <span class="token comment" spellcheck="true"># 默认是不开启aof模式的，默认是使用rdb方式持久化的，在大部分的情况下，rdb完全够用</span>
appendfilename <span class="token string">"appendonly.aof"</span>

appendfsync always <span class="token comment" spellcheck="true"># 每次修改都会sync 消耗性能</span>
appendfsync everysec <span class="token comment" spellcheck="true"># 每秒执行一次 sync 可能会丢失这一秒的数据</span>
appendfsync no <span class="token comment" spellcheck="true"># 不执行 sync ,这时候操作系统自己同步数据，速度最快</span>
</code></pre>
<p>如果这个aof文件有错误，这时候redis是启动不起来的，我需要修改这个aof文件</p>
<p>redis给我们提供了一个工具<code>redis-check-aof  --fix</code></p>
<pre class=" language-bash"><code class="language-bash">redis-check-aof  --fix appendonly.aof<span class="token comment" spellcheck="true">#修复文件</span>
</code></pre>
<blockquote>
<p>重写规则</p>
</blockquote>
<p>aof默认文件无限追加！文件会越来越大</p>
<p>如果aof文件大于64m(定制的策略)，太大了！会fork一个新的线程来将我们的文件重写</p>
<h2><span id="优缺点">优缺点</span></h2><p>优点</p>
<ol>
<li>每一次修改都会同步，文件的完整性会更加好</li>
<li>没秒同步一次，可能会丢失一秒的数据</li>
<li>从不同步，效率最高</li>
</ol>
<p>缺点</p>
<ol>
<li>相对于数据文件来说，aof远远大于rdb，修复速度比rdb慢！</li>
<li>Aof运行效率也要比rdb慢，所以我们redis默认的配置就是rdb持久化</li>
</ol>
<h2><span id="扩展">扩展：</span></h2><p>1、RDB 持久化方式能够在指定的时间间隔内对你的数据进行快照存储<br>2、AOF 持久化方式记录每次对服务器写的操作，当服务器重启的时候会重新执行这些命令来恢复原始的数据，AOF命令以Redis 协议追加保存每次写的操作到文件末尾，Redis还能对AOF文件进行后台重写，使得AOF文件的体积不至于过大。<br>3、==只做缓存，如果你只希望你的数据在服务器运行的时候存在，你也可以不使用任何持久化==<br>4、同时开启两种持久化方式</p>
<ul>
<li>在这种情况下，当redis重启的时候会优先载入AOF文件来恢复原始的数据，因为在通常情况下AOF文件保存的数据集要比RDB文件保存的数据集要完整。</li>
<li>RDB 的数据不实时，同时使用两者时服务器重启也只会找AOF文件，那要不要只使用AOF呢？作者建议不要，因为RDB更适合用于备份数据库（AOF在不断变化不好备份），快速重启，而且不会有AOF可能潜在的Bug，留着作为一个万一的手段。</li>
</ul>
<p>5、性能建议</p>
<ul>
<li>因为RDB文件只用作后备用途，建议只在Slave上持久化RDB文件，而且只要15分钟备份一次就够了，只保留 save 900 1 这条规则。</li>
<li>如果Enable AOF ，好处是在最恶劣情况下也只会丢失不超过两秒数据，启动脚本较简单只load自己的AOF文件就可以了，代价一是带来了持续的IO，二是AOF rewrite 的最后将 rewrite 过程中产生的新数据写到新文件造成的阻塞几乎是不可避免的。只要硬盘许可，应该尽量减少AOF rewrite的频率，AOF重写的基础大小默认值64M太小了，可以设到5G以上，默认超过原大小100%大小重写可以改到适当的数值。</li>
<li>如果不Enable AOF ，仅靠 Master-Slave Repllcation 实现高可用性也可以，能省掉一大笔IO，也减少了rewrite时带来的系统波动。代价是如果Master/Slave 同时倒掉，会丢失十几分钟的数据，启动脚本也要比较两个 Master/Slave 中的 RDB文件，载入较新的那个，微博就是这种架构。</li>
</ul>
<h2><span id="如何选择使用哪种持久化方式">如何选择使用哪种持久化方式？</span></h2><p>一般来说， 如果想达到足以媲美 PostgreSQL 的数据安全性， 你应该同时使用两种持久化功能。</p>
<p>如果你非常关心你的数据， 但仍然可以承受数分钟以内的数据丢失， 那么你可以只使用 RDB 持久化。</p>
<p>有很多用户都只使用 AOF 持久化， 但并不推荐这种方式： 因为定时生成 RDB 快照（snapshot）非常便于进行数据库备份， 并且 RDB 恢复数据集的速度也要比 AOF 恢复的速度要快。</p>
<h1><span id="redis发布订阅">Redis发布订阅</span></h1><p>Redis 发布订阅(pub/sub)是一种==消息通信模式==：发送者(pub)发送消息，订阅者(sub)接收消息。微信、 微博、关注系统！</p>
<p>Redis 客户端可以订阅任意数量的频道。 </p>
<p>订阅/发布消息图： 第一个：消息发送者， 第二个：频道、 第三个：消息订阅者！</p>
<p><img src="/2022/01/15/redis/image-20211203152500160.png" alt="image-20211203152500160"></p>
<p>下图展示了频道 channel1 ， 以及订阅这个频道的三个客户端 —— client2 、 client5 和 client1 之间的关系：</p>
<p><img src="/2022/01/15/redis/image-20211203152602865.png" alt="image-20211203152602865"></p>
<p>当有新消息通过 PUBLISH 命令发送给频道 channel1 时， 这个消息就会被发送给订阅它的三个客户端：</p>
<p><img src="/2022/01/15/redis/image-20211203152935113.png" alt="image-20211203152935113"></p>
<blockquote>
<p>命令</p>
</blockquote>
<p>这些命令被广泛用于构建即时通讯的通信应用，比如聊天室和实时广播、实时提醒等。</p>
<p><img src="/2022/01/15/redis/image-20211203153059435.png" alt="image-20211203153059435"></p>
<blockquote>
<p>测试</p>
</blockquote>
<pre class=" language-bash"><code class="language-bash">------------订阅端----------------------
127.0.0.1:6379<span class="token operator">></span> subscribe kuangshenshuo <span class="token comment" spellcheck="true"># 订阅kuangshenshuo频道</span>
Reading messages<span class="token punctuation">..</span>. <span class="token punctuation">(</span>press Ctrl-C to quit<span class="token punctuation">)</span>
1<span class="token punctuation">)</span> <span class="token string">"subscribe"</span>        <span class="token comment" spellcheck="true"># 订阅成功的消息</span>
2<span class="token punctuation">)</span> <span class="token string">"kuangshenshuo"</span>  
3<span class="token punctuation">)</span> <span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 1
1<span class="token punctuation">)</span> <span class="token string">"message"</span>     <span class="token comment" spellcheck="true"># 接收到来自kuangshenshuo频道的消息 "hello,kuangshen"</span>
2<span class="token punctuation">)</span> <span class="token string">"kuangshenshuo"</span>   <span class="token comment" spellcheck="true">#那个频道</span>
3<span class="token punctuation">)</span> <span class="token string">"hello,kuangshen"</span>   <span class="token comment" spellcheck="true">#发布了啥</span>
1<span class="token punctuation">)</span> <span class="token string">"message"</span>     <span class="token comment" spellcheck="true"># 接收到来自kuangshenshuo频道的消息 "hello,redis"</span>
2<span class="token punctuation">)</span> <span class="token string">"kuangshenshuo"</span>
3<span class="token punctuation">)</span> <span class="token string">"hello,redis"</span>
--------------消息发布端-------------------
127.0.0.1:6379<span class="token operator">></span> publish kuangshenshuo hello,kuangshen<span class="token comment" spellcheck="true"># 发布消息到kuangshenshuo频道</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 1
127.0.0.1:6379<span class="token operator">></span> publish kuangshenshuo hello,redis
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> 1
</code></pre>
<h2><span id="原理">原理</span></h2><p>Redis是使用C实现的，通过分析 Redis 源码里的 pubsub.c 文件，了解发布和订阅机制的底层实现，籍此加深对 Redis 的理解。</p>
<p>Redis 通过 PUBLISH 、SUBSCRIBE 和 PSUBSCRIBE 等命令实现发布和订阅功能。</p>
<p>每个 Redis 服务器进程都维持着一个表示服务器状态的 redis.h/redisServer 结构， 结构的 pubsub_channels 属性是一个字典， 这个字典就用于保存订阅频道的信息，其中，字典的键为正在被订阅的频道， 而字典的值则是一个链表， 链表中保存了所有订阅这个频道的客户端。</p>
<p><img src="/2022/01/15/redis/image-20211203154507647.png" alt="image-20211203154507647"></p>
<p>客户端订阅，就被链接到对应频道的链表的尾部，退订则就是将客户端节点从链表中移除。</p>
<h2><span id="缺点">缺点</span></h2><ol>
<li>如果一个客户端订阅了频道，但自己读取消息的速度却不够快的话，那么不断积压的消息会使redis输出缓冲区的体积变得越来越大，这可能使得redis本身的速度变慢，甚至直接崩溃。</li>
<li>这和数据传输可靠性有关，如果在订阅方断线，那么他将会丢失所有在短线期间发布者发布的消息。</li>
</ol>
<h2><span id="应用">应用</span></h2><ol>
<li>消息订阅：公众号订阅，微博关注等等（起始更多是使用消息队列来进行实现）</li>
<li>多人在线聊天室。</li>
</ol>
<p>稍微复杂的场景，我们就会使用消息中间件MQ处理。</p>
<h1><span id="redis主从复制">Redis主从复制</span></h1><h2><span id="概念">概念</span></h2><p>主从复制，是指将一台Redis服务器的数据，复制到其他的Redis服务器。前者称为主节点（Master/Leader）,后者称为从节点（Slave/Follower）， 数据的复制是单向的！只能由主节点复制到从节点（主节点以写为主、从节点以读为主）。</p>
<p>==默认情况下，每台Redis服务器都是主节点==，一个主节点可以有0个或者多个从节点，但每个从节点只能由一个主节点。</p>
<h2><span id="作用">作用</span></h2><ol>
<li>数据冗余：主从复制实现了数据的热备份，是持久化之外的一种数据冗余的方式。</li>
<li>故障恢复：当主节点故障时，从节点可以暂时替代主节点提供服务，是一种服务冗余的方式</li>
<li>负载均衡：在主从复制的基础上，配合读写分离，由主节点进行写操作，从节点进行读操作，分担服务器的负载；尤其是在多读少写的场景下，通过多个从节点分担负载，提高并发量。</li>
<li>高可用基石：主从复制还是哨兵和集群能够实施的基础。</li>
</ol>
<h2><span id="为什么使用集群">为什么使用集群</span></h2><p>一般来说，要将Redis运用于工程项目中，只使用一台Redis是万万不能的（宕机），原因如下：</p>
<p>1、从结构上，单个Redis服务器会发生单点故障，并且一台服务器需要处理所有的请求负载，压力较大；</p>
<p>2、从容量上，单个Redis服务器内存容量有限，就算一台Redis服务器内存容量为256G，也不能将所有内存用作Redis存储内存，一般来说，单台Redis最大使用内存不应该超过20G。</p>
<p>电商网站上的商品，一般都是一次上传，无数次浏览的，说专业点也就是”多读少写”。</p>
<p>对于这种场景，我们可以使如下这种架构：</p>
<p><img src="/2022/01/15/redis/image-20211203155140014.png" alt="image-20211203155140014"></p>
<p>主从复制，读写分离！ 80% 的情况下都是在进行读操作！减缓服务器的压力！</p>
<p>架构中经常使用！ 一主二从！</p>
<p>只要在公司中，主从复制就是必须要使用的，因为在真实的项目中不可能单机使用Redis！</p>
<p><strong>总结</strong></p>
<ol>
<li>单台服务器难以负载大量的请求</li>
<li>单台服务器故障率高，系统崩坏概率大</li>
<li>单台服务器内存容量有限。</li>
</ol>
<h2><span id="环境配置">环境配置</span></h2><p>只配置从库，不用配置主库！</p>
<pre class=" language-bash"><code class="language-bash">127.0.0.1:6379<span class="token operator">></span> info replication <span class="token comment" spellcheck="true">#查看当前库的信息</span>
<span class="token comment" spellcheck="true"># Replication</span>
role:master  <span class="token comment" spellcheck="true">#角色</span>
connected_slaves:0 <span class="token comment" spellcheck="true">#从机</span>
master_replid:095c10fdbaefd02f09b5d93be7ade52f9967394e
master_replid2:0000000000000000000000000000000000000000
master_repl_offset:0
second_repl_offset:-1
repl_backlog_active:0
repl_backlog_size:1048576
repl_backlog_first_byte_offset:0
repl_backlog_histlen:0
</code></pre>
<p>复制3个配置文件，然后修改对应的信息</p>
<ol>
<li>端口</li>
<li>pid名字</li>
<li>log文件名</li>
<li>dump.rdb名字</li>
</ol>
<p>启动单机多服务集群：</p>
<p><img src="/2022/01/15/redis/image-20211203181502026.png" alt="image-20211203181502026"></p>
<h2><span id="一主二从配置">一主二从配置</span></h2><p>==默认情况下，每台Redis服务器都是主节点==；我们一般情况下只用配置从机就好了！</p>
<p>认老大！一主（79）二从（80，81）</p>
<p>使用SLAVEOF host port就可以为从机配置主机了。</p>
<p><img src="/2022/01/15/redis/image-20211203182234933.png" alt="image-20211203182234933"></p>
<p><strong>说明</strong></p>
<ul>
<li><code>SLAVEOF host 6379</code> 找谁当自己的老大！</li>
<li><code>role:slave</code> # 当前角色是从机</li>
<li><code>master_host:127.0.0.1</code> # 可以的看到主机的信息</li>
</ul>
<p>然后主机上也能看到从机的状态：</p>
<p><img src="/2022/01/15/redis/image-20211203182417295.png" alt="image-20211203182417295"></p>
<p><strong>说明</strong></p>
<ul>
<li><code>connected_slaves:1</code> # 多了从机的配置</li>
<li><code>slave0:ip=127.0.0.1,port=6380,state=online,offset=42,lag=1</code> # 多了从机的配置</li>
</ul>
<p>真实的从主配置应该在配置文件中配置，这样的话是永久的，我们这里使用的是命令，暂时的！</p>
<h2><span id="使用规则">使用规则</span></h2><p>1.从机只能读，不能写，主机可读可写但是多用于写。</p>
<pre class=" language-bash"><code class="language-bash">127.0.0.1:6379<span class="token operator">></span> <span class="token keyword">set</span> k1 v1
OK
127.0.0.1:6379<span class="token operator">></span> get k1
<span class="token string">"v1"</span>
--从机可以读取主节点的key，但不能写--
127.0.0.1:6380<span class="token operator">></span> get k1
<span class="token string">"v1"</span>
127.0.0.1:6380<span class="token operator">></span> <span class="token keyword">set</span> k2 v2
<span class="token punctuation">(</span>error<span class="token punctuation">)</span> READONLY You can<span class="token string">'t write against a read only replica.

127.0.0.1:6381> get k1
"v1"
127.0.0.1:6381> set k2 v2
(error) READONLY You can'</span>t <span class="token function">write</span> against a <span class="token function">read</span> only replica.
</code></pre>
<p>2.==当主机断电宕机后，默认情况下从机的角色不会发生变化==，集群中只是失去了写操作，当主机恢复以后，又会连接上从机恢复原状。</p>
<p>3.当从机断电宕机后，若不是使用配置文件配置的从机，再次启动后作为主机是无法获取之前主机的数据的，若此时重新配置称为从机，又可以获取到主机的所有数据。这里就要提到一个同步原理。</p>
<p>4.第二条中提到，默认情况下，主机故障后，不会出现新的主机，有两种方式可以产生新的主机：</p>
<ul>
<li>从机手动执行命令slaveof no one,这样执行以后从机会独立出来成为一个主机</li>
<li>使用哨兵模式（自动选举）</li>
</ul>
<h2><span id="复制原理">复制原理</span></h2><p>==Slave 启动成功连接到 master 后会发送一个sync同步命令==(全量复制)</p>
<p>Master 接到命令，启动后台的存盘进程，同时收集所有接收到的用于修改数据集命令，在后台进程执行完毕之后，master将传送整个数据文件到slave，并完成一次完全同步。</p>
<p><strong>全量复制</strong>：而slave服务在接收到数据库文件数据后，将其存盘并加载到内存中。</p>
<p><strong>增量复制</strong>：Master 继续将新的所有收集到的修改命令依次传给slave，完成同步</p>
<p>但是只要是重新连接master，一次完全同步（全量复制）将被自动执行！ 我们的数据一定可以在从机中看到！</p>
<blockquote>
<p>层层链路</p>
</blockquote>
<p>79 - 80 - 81</p>
<p>79是80的主节点</p>
<p>80是81的主节点</p>
<p>80是主还是从？</p>
<p>从</p>
<blockquote>
<p>如果没有老大了，这个时候能不能选择出来一个老大?</p>
</blockquote>
<p>原始手动：</p>
<p>谋权篡位：如果主机断开了连接，我们可以使用<code>SLAVEOF no one</code>让自己变成主机！其他的节点就可以手动连接到最新的主节点（手动）！如果这个时候老大修复了，那么就重新连接！</p>
<h1><span id="哨兵模式">哨兵模式</span></h1><p>（自动选举老大的模式）</p>
<h2><span id="概述">概述</span></h2><p>主从切换技术的方法是：当主服务器宕机后，需要手动把一台从服务器切换为主服务器，这就需要人工干预，费事费力，还会造成一段时间内服务不可用。这不是一种推荐的方式，更多时候，我们优先考虑哨兵模式。</p>
<p>Redis从2.8开始正式提供了Sentinel（哨兵） 架构来解决这个问题。<strong>能够后台监控主机是否故障，如果故障了根据投票数自动将从库转换为主库。</strong></p>
<p>哨兵模式是一种特殊的模式，首先Redis提供了哨兵的命令，哨兵是一个独立的进程，作为进程，它会独立运行。其原理是哨兵通过发送命令，等待Redis服务器响应，从而监控运行的多个Redis实例。</p>
<p><img src="/2022/01/15/redis/image-20211203191620201.png" alt="image-20211203191620201"></p>
<p>哨兵的作用：</p>
<ul>
<li>通过发送命令，让Redis服务器返回监控其运行状态，包括主服务器和从服务器。</li>
<li>当哨兵监测到master宕机，会自动将slave切换成master，然后通过发布订阅模式通知其他的从服务器，修改配置文件，让它们切换主机。</li>
</ul>
<p>然而一个哨兵进程对Redis服务器进行监控，可能会出现问题，为此，我们可以使用多个哨兵进行监控。各个哨兵之间还会进行监控，这样就形成了<strong>多哨兵模式</strong>。</p>
<p><img src="/2022/01/15/redis/image-20211203192053063.png" alt="image-20211203192053063"></p>
<p>假设主服务器宕机，哨兵1先检测到这个结果，系统并不会马上进行failover过程，仅仅是哨兵1主观的认为主服务器不可用，这个现象成为主观下线。当后面的哨兵也检测到主服务器不可用，并且数量达到一定值时，那么哨兵之间就会进行一次投票，投票的结果由一个哨兵发起，进行failover[故障转移]操作。切换成功后，就会通过发布订阅模式，让各个哨兵把自己监控的从服务器实现切换主机，这个过程称为<strong>客观下线</strong>。</p>
<h2><span id="测试">测试</span></h2><p>目前状态是：一主二从</p>
<p>1、配置哨兵配置文件 sentinel.conf</p>
<pre class=" language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># sentinel monitor 被监控的名称 host port 1</span>
sentinel monitor myredis 127.0.0.1 6379 1
</code></pre>
<p>后面的这个数字1，代表有一个哨兵认为它挂了，他就挂了，就开始选举</p>
<p>2、启动哨兵！</p>
<pre class=" language-bash"><code class="language-bash"><span class="token punctuation">[</span>root@DTXG bin<span class="token punctuation">]</span><span class="token comment" spellcheck="true"># redis-sentinel kconfig/sentinel.conf </span>
</code></pre>
<p><img src="/2022/01/15/redis/image-20211203193232196.png" alt="image-20211203193232196"></p>
<p>3、此时哨兵监视着我们的主机6379，当我们断开主机后：</p>
<p><img src="/2022/01/15/redis/image-20211203193827419.png" alt="image-20211203193827419"></p>
<p>如果此时主机回来了，那他也只能归并到新的主机下，当作从机，这就是哨兵模式的规则！</p>
<h2><span id="哨兵模式优缺点">哨兵模式优缺点</span></h2><p>优点：</p>
<ol>
<li>哨兵集群，基于主从复制模式，所有主从复制的优点，它都有</li>
<li>主从可以切换，故障可以转移，系统的可用性更好</li>
<li>哨兵模式是主从模式的升级，手动到自动，更加健壮 缺点：</li>
</ol>
<p>缺点：</p>
<ol>
<li>Redis不好在线扩容，集群容量一旦达到上限，在线扩容就十分麻烦</li>
<li>实现哨兵模式的配置其实是很麻烦的，里面有很多配置项</li>
</ol>
<h2><span id="哨兵模式的全部配置">哨兵模式的全部配置</span></h2><p>完整的哨兵模式配置文件 sentinel.conf</p>
<pre class=" language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># Example sentinel.conf</span>
<span class="token comment" spellcheck="true">#哨兵sentinel实例运行的端口 默认26379</span>
port 26379

<span class="token comment" spellcheck="true">#哨兵sentinel的工作目录</span>
<span class="token function">dir</span> /tmp

<span class="token comment" spellcheck="true">#哨兵sentinel监控的redis主节点的 ip port</span>
<span class="token comment" spellcheck="true">#master-name  可以自己命名的主节点名字 只能由字母A-z、数字0-9 、这三个字符".-_"组成。</span>
<span class="token comment" spellcheck="true">#quorum 当这些quorum个数sentinel哨兵认为master主节点失联 那么这时 客观上认为主节点失联了</span>
<span class="token comment" spellcheck="true">#sentinel monitor &lt;master-name> &lt;ip> &lt;redis-port> &lt;quorum></span>
sentinel monitor mymaster 127.0.0.1 6379 2



<span class="token comment" spellcheck="true">#当在Redis实例中开启了requirepass foobared 授权密码 这样所有连接Redis实例的客户端都要提供密码</span>
<span class="token comment" spellcheck="true">#设置哨兵sentinel 连接主从的密码 注意必须为主从设置一样的验证密码</span>
<span class="token comment" spellcheck="true">#sentinel auth-pass &lt;master-name> &lt;password></span>
sentinel auth-pass mymaster MySUPER--secret-0123passw0rd



<span class="token comment" spellcheck="true">#指定多少毫秒之后 主节点没有应答哨兵sentinel 此时 哨兵主观上认为主节点下线 默认30秒</span>
<span class="token comment" spellcheck="true">#sentinel down-after-milliseconds &lt;master-name> &lt;milliseconds></span>
sentinel down-after-milliseconds mymaster 30000

<span class="token comment" spellcheck="true">#这个配置项指定了在发生failover主备切换时最多可以有多少个slave同时对新的master进行 同步，</span>
<span class="token comment" spellcheck="true">#这个数字越小，完成failover所需的时间就越长，</span>
<span class="token comment" spellcheck="true">#但是如果这个数字越大，就意味着越 多的slave因为replication而不可用。</span>
<span class="token comment" spellcheck="true">#可以通过将这个值设为 1 来保证每次只有一个slave 处于不能处理命令请求的状态。</span>
<span class="token comment" spellcheck="true">#sentinel parallel-syncs &lt;master-name> &lt;numslaves></span>
sentinel parallel-syncs mymaster 1


<span class="token comment" spellcheck="true">#故障转移的超时时间 failover-timeout 可以用在以下这些方面：</span>
<span class="token comment" spellcheck="true">#1. 同一个sentinel对同一个master两次failover之间的间隔时间。</span>
<span class="token comment" spellcheck="true">#2. 当一个slave从一个错误的master那里同步数据开始计算时间。直到slave被纠正为向正确的master那里同步数据时。</span>
<span class="token comment" spellcheck="true">#3.当想要取消一个正在进行的failover所需要的时间。</span>
<span class="token comment" spellcheck="true">#4.当进行failover时，配置所有slaves指向新的master所需的最大时间。不过，即使过了这个超时，slaves依然会被正确配置为指向master，但是就不按parallel-syncs所配置的规则来了</span>
<span class="token comment" spellcheck="true">#默认三分钟</span>
<span class="token comment" spellcheck="true">#sentinel failover-timeout &lt;master-name> &lt;milliseconds></span>
sentinel failover-timeout mymaster 180000



<span class="token comment" spellcheck="true">#SCRIPTS EXECUTION</span>
<span class="token comment" spellcheck="true">#配置当某一事件发生时所需要执行的脚本，可以通过脚本来通知管理员，例如当系统运行不正常时发邮件通知相关人员。</span>
<span class="token comment" spellcheck="true">#对于脚本的运行结果有以下规则：</span>
<span class="token comment" spellcheck="true">#若脚本执行后返回1，那么该脚本稍后将会被再次执行，重复次数目前默认为10</span>
<span class="token comment" spellcheck="true">#若脚本执行后返回2，或者比2更高的一个返回值，脚本将不会重复执行。</span>
<span class="token comment" spellcheck="true">#如果脚本在执行过程中由于收到系统中断信号被终止了，则同返回值为1时的行为相同。</span>
<span class="token comment" spellcheck="true">#一个脚本的最大执行时间为60s，如果超过这个时间，脚本将会被一个SIGKILL信号终止，之后重新执行。</span>
<span class="token comment" spellcheck="true">#通知型脚本:当sentinel有任何警告级别的事件发生时（比如说redis实例的主观失效和客观失效等等），将会去调用这个脚本，</span>
<span class="token comment" spellcheck="true">#这时这个脚本应该通过邮件，SMS等方式去通知系统管理员关于系统不正常运行的信息。调用该脚本时，将传给脚本两个参数，一个是事件的类型，一个是事件的描述。</span>
<span class="token comment" spellcheck="true">#如果sentinel.conf配置文件中配置了这个脚本路径，那么必须保证这个脚本存在于这个路径，并且是可执行的，否则sentinel无法正常启动成功。</span>
<span class="token comment" spellcheck="true">#通知脚本</span>
<span class="token comment" spellcheck="true">#sentinel notification-script &lt;master-name> &lt;script-path></span>
sentinel notification-script mymaster /var/redis/notify.sh


<span class="token comment" spellcheck="true">#客户端重新配置主节点参数脚本</span>
<span class="token comment" spellcheck="true">#当一个master由于failover而发生改变时，这个脚本将会被调用，通知相关的客户端关于master地址已经发生改变的信息。</span>
<span class="token comment" spellcheck="true">#以下参数将会在调用脚本时传给脚本:</span>
<span class="token comment" spellcheck="true">#&lt;master-name> &lt;role> &lt;state> &lt;from-ip> &lt;from-port> &lt;to-ip> &lt;to-port></span>
<span class="token comment" spellcheck="true">#目前&lt;state>总是“failover”,</span>
<span class="token comment" spellcheck="true">#&lt;role>是“leader”或者“observer”中的一个。</span>
<span class="token comment" spellcheck="true">#参数 from-ip, from-port, to-ip, to-port是用来和旧的master和新的master(即旧的slave)通信的</span>
<span class="token comment" spellcheck="true">#这个脚本应该是通用的，能被多次调用，不是针对性的。</span>
<span class="token comment" spellcheck="true">#sentinel client-reconfig-script &lt;master-name> &lt;script-path></span>
sentinel client-reconfig-script mymaster /var/redis/reconfig.sh
</code></pre>
<h1><span id="缓存穿透与雪崩">缓存穿透与雪崩</span></h1><h2><span id="缓存穿透即查询不到">缓存穿透（即查询不到）</span></h2><h3><span id="概念">概念</span></h3><p>在默认情况下，用户请求数据时，会先在缓存(Redis)中查找，若没找到即缓存未命中，再在数据库中进行查找，数量少可能问题不大，可是一旦大量的请求数据（例如秒杀场景）缓存都没有命中的话，就会全部转移到数据库上，造成数据库极大的压力，就有可能导致数据库崩溃。网络安全中也有人恶意使用这种手段进行攻击被称为洪水攻击。</p>
<p><img src="/2022/01/15/redis/image-20211203200028925.png" alt="image-20211203200028925"></p>
<h3><span id="解决方案">解决方案</span></h3><p><strong>布隆过滤器</strong></p>
<p>对所有可能查询的参数以Hash的形式存储，以便快速确定是否存在这个值，在控制层先进行拦截校验，校验不通过直接打回，减轻了存储系统的压力。</p>
<p><img src="/2022/01/15/redis/image-20211203200333546.png" alt="image-20211203200333546"></p>
<p><strong>缓存空对象</strong></p>
<p>一次请求若在缓存和数据库中都没找到，就在缓存中方一个空对象用于处理后续这个请求。</p>
<p><img src="/2022/01/15/redis/image-20211203200527253.png" alt="image-20211203200527253"></p>
<p>这样做有一个缺陷：存储空对象也需要空间，大量的空对象会耗费一定的空间，存储效率并不高。解决这个缺陷的方式就是设置较短过期时间</p>
<p>即使对空值设置了过期时间，还是会存在缓存层和存储层的数据会有一段时间窗口的不一致，这对于需要保持一致性的业务会有影响。</p>
<h2><span id="缓存击穿即量太大缓存过期">缓存击穿（即量太大，缓存过期）</span></h2><h3><span id="概念">概念</span></h3><p>相较于缓存穿透，缓存击穿的目的性更强，一个存在的key，在缓存过期的一刻，同时有大量的请求，这些请求都会击穿到DB，造成瞬时DB请求量大、压力骤增。这就是缓存被击穿，只是针对其中某个key的缓存不可用而导致击穿，但是其他的key依然可以使用缓存响应。</p>
<p> 比如热搜排行上，一个热点新闻被同时大量访问就可能导致缓存击穿。</p>
<h3><span id="解决方案">解决方案</span></h3><p>1.设置热点数据永不过期</p>
<p>这样就不会出现热点数据过期的情况，但是当Redis内存空间满的时候也会清理部分数据，而且此种方案会占用空间，一旦热点数据多了起来，就会占用部分空间。</p>
<p>2.加互斥锁(分布式锁)</p>
<p>在访问key之前，采用SETNX（set if not exists）来设置另一个短期key来锁住当前key的访问，访问结束再删除该短期key。保证同时刻只有一个线程访问。这样对锁的要求就十分高。</p>
<h2><span id="缓存雪崩">缓存雪崩</span></h2><h3><span id="概念">概念</span></h3><p>大量的key设置了相同的过期时间，导致在缓存在同一时刻全部失效，造成瞬时DB请求量大、压力骤增，引起雪崩。</p>
<p>缓存雪崩，是指在某一个时间段，缓存集中过期失效。Redis 宕机！</p>
<p>产生雪崩的原因之一，比如在写本文的时候，马上就要到双十二零点，很快就会迎来一波抢购，这波商品时间比较集中的放入了缓存，假设缓存一个小时。那么到了凌晨一点钟的时候，这批商品的缓存就都过期了。而对这批商品的访问查询，都落到了数据库上，对于数据库而言，就会产生周期性的压力波峰。于是所有的请求都会达到存储层，存储层的调用量会暴增，造成存储层也会挂掉的情况。</p>
<p><img src="/2022/01/15/redis/image-20211203201418097.png" alt="image-20211203201418097"></p>
<p>其实集中过期，倒不是非常致命，比较致命的缓存雪崩，是缓存服务器某个节点宕机或断网。因为自然形成的缓存雪崩，一定是在某个时间段集中创建缓存，这个时候，数据库也是可以顶住压力的。无非就是对数据库产生周期性的压力而已。而缓存服务节点的宕机，对数据库服务器造成的压力是不可预知的，很有可能瞬间就把数据库压垮。</p>
<h3><span id="解决方案">解决方案</span></h3><blockquote>
<p>redis高可用</p>
</blockquote>
<p>这个思想的含义是，既然redis有可能挂掉，那我多增设几台redis，这样一台挂掉之后其他的还可以继续工作，其实就是搭建的集群</p>
<blockquote>
<p>限流降级</p>
</blockquote>
<p>这个解决方案的思想是，在缓存失效后，通过加锁或者队列来控制读数据库写缓存的线程数量。比如对某个key只允许一个线程查询数据和写缓存，其他线程等待。</p>
<blockquote>
<p>数据预热</p>
</blockquote>
<p>数据加热的含义就是在正式部署之前，我先把可能的数据先预先访问一遍，这样部分可能大量访问的数据就会加载到缓存中。在即将发生大并发访问前手动触发加载缓存不同的key，设置不同的过期时间，让缓存失效的时间点尽量均匀。</p>

                
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        文章作者:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="/about" rel="external nofollow noreferrer">DTXG</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        文章链接:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://dtxt.github.io/2022/01/15/redis/">https://dtxt.github.io/2022/01/15/redis/</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        版权声明:
                    </i>
                </span>
                <span class="reprint-info">
                    本博客所有文章除特別声明外，均采用
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    许可协议。转载请注明来源
                    <a href="/about" target="_blank">DTXG</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/Redis/">
                                    <span class="chip bg-color">Redis</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
        </div>
    </div>

    

    

    

    

    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="/2022/01/15/shu-ju-jie-gou-he-suan-fa-wei-wan/">
                    <div class="card-image">
                        
                        <img src="https://img2.baidu.com/it/u=3568589326,501800820&fm=253&fmt=auto&app=138&f=JPEG?w=798&h=500" class="responsive-img" alt="数据结构和算法">
                        
                        <span class="card-title">数据结构和算法</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            数据结构和算法
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2022-01-15
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%92%8C%E7%AE%97%E6%B3%95/" class="post-category">
                                    数据结构和算法
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%92%8C%E7%AE%97%E6%B3%95/">
                        <span class="chip bg-color">数据结构和算法</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2022/01/10/gulimall-bi-ji/">
                    <div class="card-image">
                        
                        <img src="https://img2.baidu.com/it/u=2909068583,1783215639&fm=253&fmt=auto&app=138&f=PNG?w=952&h=500" class="responsive-img" alt="项目笔记">
                        
                        <span class="card-title">项目笔记</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            谷粒商城
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2022-01-10
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/%E7%AC%94%E8%AE%B0/" class="post-category">
                                    笔记
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/%E5%95%86%E5%9F%8E/">
                        <span class="chip bg-color">商城</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>


<script>
    $('#articleContent').on('copy', function (e) {
        // IE8 or earlier browser is 'undefined'
        if (typeof window.getSelection === 'undefined') return;

        var selection = window.getSelection();
        // if the selection is short let's not annoy our users.
        if (('' + selection).length < Number.parseInt('120')) {
            return;
        }

        // create a div outside of the visible area and fill it with the selected text.
        var bodyElement = document.getElementsByTagName('body')[0];
        var newdiv = document.createElement('div');
        newdiv.style.position = 'absolute';
        newdiv.style.left = '-99999px';
        bodyElement.appendChild(newdiv);
        newdiv.appendChild(selection.getRangeAt(0).cloneContents());

        // we need a <pre> tag workaround.
        // otherwise the text inside "pre" loses all the line breaks!
        if (selection.getRangeAt(0).commonAncestorContainer.nodeName === 'PRE' || selection.getRangeAt(0).commonAncestorContainer.nodeName === 'CODE') {
            newdiv.innerHTML = "<pre>" + newdiv.innerHTML + "</pre>";
        }

        var url = document.location.href;
        newdiv.innerHTML += '<br />'
            + '来源: DTXG的世界<br />'
            + '文章作者: DTXG<br />'
            + '文章链接: <a href="' + url + '">' + url + '</a><br />'
            + '本文章著作权归作者所有，任何形式的转载都请注明出处。';

        selection.selectAllChildren(newdiv);
        window.setTimeout(function () {bodyElement.removeChild(newdiv);}, 200);
    });
</script>


<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>

<!-- 代码语言 -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>


    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget card" style="background-color: white;">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('0'),
            headingSelector: 'h1, h2, h3'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h1, h2, h3').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>




    <footer class="page-footer bg-color">
    

    <div class="container row center-align"
         style="margin-bottom: 15px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            
                <span id="year">2022</span>
            
            <a href="/about" target="_blank">DTXG</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            <br>
            
                &nbsp;<i class="fas fa-chart-area"></i>&nbsp;站点总字数:&nbsp;<span
                        class="white-color">114.9k</span>
            
            
            
                
            
            
                <span id="busuanzi_container_site_pv">
                &nbsp;|&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;
                    <span id="busuanzi_value_site_pv" class="white-color"></span>
            </span>
            
            
                <span id="busuanzi_container_site_uv">
                &nbsp;|&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;
                    <span id="busuanzi_value_site_uv" class="white-color"></span>
            </span>
            
            <br> 

            <!-- 运行天数提醒. -->
            
                <span id="sitetime"> Loading ...</span>
                <script>
                    var calcSiteTime = function () {
                        var seconds = 1000;
                        var minutes = seconds * 60;
                        var hours = minutes * 60;
                        var days = hours * 24;
                        var years = days * 365;
                        var today = new Date();
                        var startYear = "2022";
                        var startMonth = "1";
                        var startDate = "8";
                        var startHour = "2";
                        var startMinute = "4";
                        var startSecond = "22";
                        var todayYear = today.getFullYear();
                        var todayMonth = today.getMonth() + 1;
                        var todayDate = today.getDate();
                        var todayHour = today.getHours();
                        var todayMinute = today.getMinutes();
                        var todaySecond = today.getSeconds();
                        var t1 = Date.UTC(startYear, startMonth, startDate, startHour, startMinute, startSecond);
                        var t2 = Date.UTC(todayYear, todayMonth, todayDate, todayHour, todayMinute, todaySecond);
                        var diff = t2 - t1;
                        var diffYears = Math.floor(diff / years);
                        var diffDays = Math.floor((diff / days) - diffYears * 365);

                        // 区分是否有年份.
                        var language = 'zh-CN';
                        if (startYear === String(todayYear)) {
                            document.getElementById("year").innerHTML = todayYear;
                            var daysTip = 'This site has been running for ' + diffDays + ' days';
                            if (language === 'zh-CN') {
                                daysTip = '本站已运行 ' + diffDays + ' 天';
                            } else if (language === 'zh-HK') {
                                daysTip = '本站已運行 ' + diffDays + ' 天';
                            }
                            document.getElementById("sitetime").innerHTML = daysTip;
                        } else {
                            document.getElementById("year").innerHTML = startYear + " - " + todayYear;
                            var yearsAndDaysTip = 'This site has been running for ' + diffYears + ' years and '
                                + diffDays + ' days';
                            if (language === 'zh-CN') {
                                yearsAndDaysTip = '本站已运行 ' + diffYears + ' 年 ' + diffDays + ' 天';
                            } else if (language === 'zh-HK') {
                                yearsAndDaysTip = '本站已運行 ' + diffYears + ' 年 ' + diffDays + ' 天';
                            }
                            document.getElementById("sitetime").innerHTML = yearsAndDaysTip;
                        }
                    }

                    calcSiteTime();
                </script>
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">


    <a href="mailto:2507566674@qq.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>







    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=2507566674" class="tooltipped" target="_blank" data-tooltip="QQ联系我: 2507566674" data-position="top" data-delay="50">
        <i class="fab fa-qq"></i>
    </a>







    <a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50">
        <i class="fas fa-rss"></i>
    </a>

</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script type="text/javascript">
$(function () {
    var searchFunc = function (path, search_id, content_id) {
        'use strict';
        $.ajax({
            url: path,
            dataType: "xml",
            success: function (xmlResponse) {
                // get the contents from search data
                var datas = $("entry", xmlResponse).map(function () {
                    return {
                        title: $("title", this).text(),
                        content: $("content", this).text(),
                        url: $("url", this).text()
                    };
                }).get();
                var $input = document.getElementById(search_id);
                var $resultContent = document.getElementById(content_id);
                $input.addEventListener('input', function () {
                    var str = '<ul class=\"search-result-list\">';
                    var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                    $resultContent.innerHTML = "";
                    if (this.value.trim().length <= 0) {
                        return;
                    }
                    // perform local searching
                    datas.forEach(function (data) {
                        var isMatch = true;
                        var data_title = data.title.trim().toLowerCase();
                        var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                        var data_url = data.url;
                        data_url = data_url.indexOf('/') === 0 ? data.url : '/' + data_url;
                        var index_title = -1;
                        var index_content = -1;
                        var first_occur = -1;
                        // only match artiles with not empty titles and contents
                        if (data_title !== '' && data_content !== '') {
                            keywords.forEach(function (keyword, i) {
                                index_title = data_title.indexOf(keyword);
                                index_content = data_content.indexOf(keyword);
                                if (index_title < 0 && index_content < 0) {
                                    isMatch = false;
                                } else {
                                    if (index_content < 0) {
                                        index_content = 0;
                                    }
                                    if (i === 0) {
                                        first_occur = index_content;
                                    }
                                }
                            });
                        }
                        // show search results
                        if (isMatch) {
                            str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                            var content = data.content.trim().replace(/<[^>]+>/g, "");
                            if (first_occur >= 0) {
                                // cut out 100 characters
                                var start = first_occur - 20;
                                var end = first_occur + 80;
                                if (start < 0) {
                                    start = 0;
                                }
                                if (start === 0) {
                                    end = 100;
                                }
                                if (end > content.length) {
                                    end = content.length;
                                }
                                var match_content = content.substr(start, end);
                                // highlight all keywords
                                keywords.forEach(function (keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    match_content = match_content.replace(regS, "<em class=\"search-keyword\">" + keyword + "</em>");
                                });

                                str += "<p class=\"search-result\">" + match_content + "...</p>"
                            }
                            str += "</li>";
                        }
                    });
                    str += "</ul>";
                    $resultContent.innerHTML = str;
                });
            }
        });
    };

    searchFunc('/search.xml', 'searchInput', 'searchResult');
});
</script>

    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    

    

    <!-- 雪花特效 -->
     
        <script type="text/javascript">
            // 只在桌面版网页启用特效
            var windowWidth = $(window).width();
            if (windowWidth > 768) {
                document.write('<script type="text/javascript" src="/libs/others/snow.js"><\/script>');
            }
        </script>
    

    <!-- 鼠标星星特效 -->
    

     
        <script src="https://ssl.captcha.qq.com/TCaptcha.js"></script>
        <script src="/libs/others/TencentCaptcha.js"></script>
        <button id="TencentCaptcha" data-appid="xxxxxxxxxx" data-cbfn="callback" type="button" hidden></button>
    

    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    <script src="/libs/others/clicklove.js" async="async"></script>
    
    
    <script async src="/libs/others/busuanzi.pure.mini.js"></script>
    

    

    

    <!--腾讯兔小巢-->
    
    
    <script type="text/javascript" color="0,0,255"
        pointColor="0,0,255" opacity='0.7'
        zIndex="-1" count="99"
        src="/libs/background/canvas-nest.js"></script>
    

    

    

    
    <script src="/libs/instantpage/instantpage.js" type="module"></script>
    

</body>

</html>
